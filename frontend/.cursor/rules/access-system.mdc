---
alwaysApply: true
---

# Web-Antd æƒé™ç³»ç»Ÿè®¾è®¡åˆ†æ

> æœ¬æ–‡æ¡£æ˜¯ **`apps/web-antd`** é¡¹ç›®çš„æƒé™ç³»ç»Ÿä½¿ç”¨è§„èŒƒï¼ŒåŸºäºå®é™…é¡¹ç›®ä»£ç ç¼–å†™ã€‚

## ğŸ“‹ ç›®å½•

1. [æƒé™ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ](#æƒé™ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ)
2. [æƒé™ç ç®¡ç†](#æƒé™ç ç®¡ç†)
3. [æƒé™æ£€æŸ¥æ–¹å¼å¯¹æ¯”](#æƒé™æ£€æŸ¥æ–¹å¼å¯¹æ¯”)
4. [è·¯ç”±æƒé™è®¾è®¡](#è·¯ç”±æƒé™è®¾è®¡)
5. [æŒ‰é’®æƒé™è®¾è®¡](#æŒ‰é’®æƒé™è®¾è®¡)
6. [è¡¨æ ¼æ“ä½œæŒ‰é’®æƒé™](#è¡¨æ ¼æ“ä½œæŒ‰é’®æƒé™)
7. [è§’è‰²æƒé™è®¾è®¡](#è§’è‰²æƒé™è®¾è®¡)
8. [æƒé™ç æƒé™è®¾è®¡](#æƒé™ç æƒé™è®¾è®¡)
9. [æƒé™æ¨¡å¼ï¼ˆå‰ç«¯/åç«¯ï¼‰](#æƒé™æ¨¡å¼å‰åç«¯)
10. [æ ¸å¿ƒç»„ä»¶ä¸ API](#æ ¸å¿ƒç»„ä»¶ä¸-api)
11. [å®é™…ä½¿ç”¨ç¤ºä¾‹](#å®é™…ä½¿ç”¨ç¤ºä¾‹)

---

## æƒé™ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

**web-antd** é¡¹ç›®çš„æƒé™ç³»ç»Ÿé‡‡ç”¨**å¤šå±‚çº§æƒé™æ§åˆ¶**è®¾è®¡ï¼Œæ”¯æŒï¼š

- âœ… **è·¯ç”±æƒé™**ï¼šæ§åˆ¶é¡µé¢è®¿é—®ï¼ˆé€šè¿‡ `meta.authority` é…ç½®ï¼‰
- âœ… **æŒ‰é’®æƒé™**ï¼šæ§åˆ¶æŒ‰é’®/ç»„ä»¶æ˜¾ç¤ºï¼ˆä½¿ç”¨ `v-access:code` æŒ‡ä»¤ï¼‰
- âœ… **è¡¨æ ¼æ“ä½œæƒé™**ï¼šæ§åˆ¶è¡¨æ ¼æ“ä½œæŒ‰é’®æ˜¾ç¤ºï¼ˆä½¿ç”¨ `usePermissions` hookï¼‰
- âœ… **è§’è‰²æƒé™**ï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰
- âœ… **æƒé™ç æƒé™**ï¼šåŸºäºæƒé™ç çš„ç»†ç²’åº¦æ§åˆ¶ï¼ˆæ ¼å¼ï¼š`ac:module:resource:action`ï¼‰

### æƒé™ç³»ç»Ÿæµç¨‹å›¾

```
ç”¨æˆ·ç™»å½•
  â†“
è·å– accessToken
  â†“
è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆåŒ…å« rolesï¼‰
  â†“
è·å–æƒé™ç åˆ—è¡¨ï¼ˆaccessCodesï¼‰
  â†“
è·¯ç”±å®ˆå«æ‹¦æˆªï¼ˆrouter/guard.tsï¼‰
  â†“
ç”Ÿæˆå¯è®¿é—®è·¯ç”±ï¼ˆæ ¹æ® roles æˆ–åç«¯èœå•ï¼‰
  â†“
ç”Ÿæˆå¯è®¿é—®èœå•
  â†“
é¡µé¢æ¸²æŸ“
  â†“
ç»„ä»¶/æŒ‰é’®æƒé™æ£€æŸ¥ï¼ˆv-access æŒ‡ä»¤ æˆ– usePermissions hookï¼‰
```

---

## æƒé™ç ç®¡ç†

### 1. æƒé™ç å®šä¹‰

**web-antd** é¡¹ç›®ä½¿ç”¨ç»Ÿä¸€çš„æƒé™ç å¸¸é‡ç®¡ç†ï¼Œä½äº `src/constants/permission-codes.ts`ï¼š

```typescript
/**
 * ç³»ç»Ÿç®¡ç†æ¨¡å—æƒé™ç 
 * ä½¿ç”¨ ac:module:resource:action æ ¼å¼
 */
export const SYSTEM_PERMISSION_CODES = {
  // ç”¨æˆ·ç®¡ç†
  USER: {
    VIEW: 'ac:system:user:view',
    ADD: 'ac:system:user:add',
    EDIT: 'ac:system:user:edit',
    DELETE: 'ac:system:user:delete',
  },
  // è§’è‰²ç®¡ç†
  ROLE: {
    VIEW: 'ac:system:role:view',
    ADD: 'ac:system:role:add',
    EDIT: 'ac:system:role:edit',
    DELETE: 'ac:system:role:delete',
  },
  // èœå•ç®¡ç†
  MENU: {
    VIEW: 'ac:system:menu:view',
    ADD: 'ac:system:menu:add',
    EDIT: 'ac:system:menu:edit',
    DELETE: 'ac:system:menu:delete',
  },
  // éƒ¨é—¨ç®¡ç†
  DEPT: {
    VIEW: 'ac:system:dept:view',
    ADD: 'ac:system:dept:add',
    EDIT: 'ac:system:dept:edit',
    DELETE: 'ac:system:dept:delete',
  },
  // æ“ä½œæ—¥å¿—ç®¡ç†
  OPERATION_LOG: {
    VIEW: 'ac:system:operation-log:view',
    DELETE: 'ac:system:operation-log:delete',
  },
} as const;
```

### 2. æƒé™ç æ ¼å¼è§„èŒƒ

- **æ ¼å¼**ï¼š`ac:module:resource:action`
- **ç¤ºä¾‹**ï¼š`ac:system:user:add`ï¼ˆç³»ç»Ÿæ¨¡å—-ç”¨æˆ·èµ„æº-æ–°å¢æ“ä½œï¼‰
- **å‘½åè§„èŒƒ**ï¼š
  - `module`ï¼šæ¨¡å—åç§°ï¼ˆå¦‚ `system`ã€`dashboard`ï¼‰
  - `resource`ï¼šèµ„æºåç§°ï¼ˆå¦‚ `user`ã€`role`ã€`menu`ï¼‰
  - `action`ï¼šæ“ä½œç±»å‹ï¼ˆå¦‚ `view`ã€`add`ã€`edit`ã€`delete`ï¼‰

### 3. ä½¿ç”¨æƒé™ç 

```typescript
import { SYSTEM_PERMISSION_CODES } from '#/constants/permission-codes';

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
const addPermission = SYSTEM_PERMISSION_CODES.USER.ADD; // 'ac:system:user:add'
```

---

## æƒé™æ£€æŸ¥æ–¹å¼å¯¹æ¯”

**web-antd** é¡¹ç›®æä¾›äº†ä¸¤ç§æƒé™æ£€æŸ¥æ–¹å¼ï¼Œå„æœ‰é€‚ç”¨åœºæ™¯ï¼š

### æ–¹å¼ä¸€ï¼šç›´æ¥ä½¿ç”¨ `useAccess`ï¼ˆåº•å±‚ APIï¼‰

**æ¥æº**ï¼š`@vben/access` åŒ…æä¾›çš„åŸºç¡€æƒé™æ£€æŸ¥ hook

```typescript
import { useAccess } from '@vben/access';
import { SYSTEM_PERMISSION_CODES } from '#/constants/permission-codes';

const { hasAccessByCodes, hasAccessByRoles } = useAccess();

// æ£€æŸ¥å•ä¸ªæƒé™ç 
const canAdd = hasAccessByCodes([SYSTEM_PERMISSION_CODES.USER.ADD]);

// æ£€æŸ¥å¤šä¸ªæƒé™ç ï¼ˆä»»ä¸€æ»¡è¶³å³å¯ï¼‰
const canEditOrDelete = hasAccessByCodes([
  SYSTEM_PERMISSION_CODES.USER.EDIT,
  SYSTEM_PERMISSION_CODES.USER.DELETE,
]);

// æ£€æŸ¥è§’è‰²
const isAdmin = hasAccessByRoles(['admin']);
```

**ç‰¹ç‚¹**ï¼š
- âœ… åº•å±‚ APIï¼ŒåŠŸèƒ½å®Œæ•´
- âœ… æ”¯æŒæ£€æŸ¥å¤šä¸ªæƒé™ç /è§’è‰²
- âŒ éœ€è¦æ‰‹åŠ¨ä¼ å…¥æƒé™ç æ•°ç»„
- âŒ ä»£ç ç›¸å¯¹å†—é•¿

### æ–¹å¼äºŒï¼šä½¿ç”¨ `usePermissions`ï¼ˆæ¨èï¼‰â­

**æ¥æº**ï¼š`apps/web-antd/src/hooks/use-permissions.ts`ï¼Œé¡¹ç›®è‡ªå®šä¹‰å°è£…

```typescript
import { usePermissions } from '#/hooks/use-permissions';
import { SYSTEM_PERMISSION_CODES } from '#/constants/permission-codes';

const { hasPermission } = usePermissions(SYSTEM_PERMISSION_CODES.USER);

// æ£€æŸ¥æƒé™ï¼ˆæ›´ç®€æ´ï¼‰
const canAdd = hasPermission.ADD();
const canEdit = hasPermission.EDIT();
const canDelete = hasPermission.DELETE();
```

**ç‰¹ç‚¹**ï¼š
- âœ… **ä»£ç æ›´ç®€æ´**ï¼š`hasPermission.ADD()` vs `hasAccessByCodes([SYSTEM_PERMISSION_CODES.USER.ADD])`
- âœ… **ç±»å‹å®‰å…¨**ï¼šTypeScript è‡ªåŠ¨æ¨æ–­æƒé™ç ç±»å‹
- âœ… **å¼€å‘ä½“éªŒå¥½**ï¼šIDE è‡ªåŠ¨è¡¥å…¨æƒé™æ–¹æ³•
- âœ… **ç»Ÿä¸€ç®¡ç†**ï¼šä¸æƒé™ç å¸¸é‡ç»‘å®šï¼Œé¿å…ç¡¬ç¼–ç 
- âœ… **é€‚åˆè¡¨æ ¼æ“ä½œ**ï¼šåœ¨ `data.ts` ä¸­é…ç½®æ“ä½œæŒ‰é’®æƒé™æ—¶éå¸¸æ–¹ä¾¿

**å®ç°åŸç†**ï¼š

```typescript
// hooks/use-permissions.ts
export function usePermissions<T extends PermissionCodesObject>(codes: T) {
  const { hasAccessByCodes } = useAccess(); // å†…éƒ¨ä½¿ç”¨ useAccess

  const hasPermission = {} as Record<keyof T, () => boolean>;

  for (const key in codes) {
    if (Object.prototype.hasOwnProperty.call(codes, key)) {
      const code = codes[key] as string;
      hasPermission[key] = () => hasAccessByCodes([code]);
    }
  }

  return {
    permissionCodes: codes,
    hasPermission,
  };
}
```

### ä½¿ç”¨å»ºè®®

| åœºæ™¯ | æ¨èæ–¹å¼ | åŸå›  |
|------|---------|------|
| **è¡¨æ ¼æ“ä½œæŒ‰é’®æƒé™** | `usePermissions` | ä»£ç ç®€æ´ï¼Œç±»å‹å®‰å…¨ï¼Œä¾¿äºåœ¨ `data.ts` ä¸­é…ç½® |
| **é¡µé¢æŒ‰é’®æƒé™** | `v-access:code` æŒ‡ä»¤ | å£°æ˜å¼ï¼Œè‡ªåŠ¨å¤„ç† DOM æ˜¾ç¤º/éšè— |
| **ç¼–ç¨‹å¼æƒé™åˆ¤æ–­** | `usePermissions` | ä»£ç æ›´ç®€æ´ï¼Œç±»å‹å®‰å…¨ |
| **éœ€è¦æ£€æŸ¥å¤šä¸ªæƒé™ç ** | `useAccess` | æ”¯æŒä¼ å…¥æ•°ç»„ï¼Œæ›´çµæ´» |
| **éœ€è¦æ£€æŸ¥è§’è‰²** | `useAccess` | `usePermissions` åªæ”¯æŒæƒé™ç  |

**æ€»ç»“**ï¼š
- âœ… **æ¨èä½¿ç”¨ `usePermissions`**ï¼šé€‚åˆå¤§å¤šæ•°åœºæ™¯ï¼Œä»£ç æ›´ç®€æ´ã€ç±»å‹æ›´å®‰å…¨
- âœ… **ä¿ç•™ `useAccess`**ï¼šç”¨äºéœ€è¦æ£€æŸ¥å¤šä¸ªæƒé™ç æˆ–è§’è‰²çš„ç‰¹æ®Šåœºæ™¯
- âœ… **ä¸¤è€…é…åˆä½¿ç”¨**ï¼š`usePermissions` æ˜¯å¯¹ `useAccess` çš„å°è£…ï¼Œåº•å±‚ä»ä½¿ç”¨ `useAccess`

---

## è·¯ç”±æƒé™è®¾è®¡

### 1. è·¯ç”±å®ˆå«æœºåˆ¶

è·¯ç”±æƒé™é€šè¿‡ `router/guard.ts` ä¸­çš„ `setupAccessGuard` å®ç°ï¼š

```typescript:47:120:apps/web-antd/src/router/guard.ts
function setupAccessGuard(router: Router) {
  router.beforeEach(async (to, from) => {
    const accessStore = useAccessStore();
    const userStore = useUserStore();
    const authStore = useAuthStore();

    // åŸºæœ¬è·¯ç”±ï¼Œè¿™äº›è·¯ç”±ä¸éœ€è¦è¿›å…¥æƒé™æ‹¦æˆª
    if (coreRouteNames.includes(to.name as string)) {
      if (to.path === LOGIN_PATH && accessStore.accessToken) {
        return decodeURIComponent(
          (to.query?.redirect as string) ||
            userStore.userInfo?.homePath ||
            preferences.app.defaultHomePath,
        );
      }
      return true;
    }

    // accessToken æ£€æŸ¥
    if (!accessStore.accessToken) {
      // æ˜ç¡®å£°æ˜å¿½ç•¥æƒé™è®¿é—®æƒé™ï¼Œåˆ™å¯ä»¥è®¿é—®
      if (to.meta.ignoreAccess) {
        return true;
      }

      // æ²¡æœ‰è®¿é—®æƒé™ï¼Œè·³è½¬ç™»å½•é¡µé¢
      if (to.fullPath !== LOGIN_PATH) {
        return {
          path: LOGIN_PATH,
          query:
            to.fullPath === preferences.app.defaultHomePath
              ? {}
              : { redirect: encodeURIComponent(to.fullPath) },
          replace: true,
        };
      }
      return to;
    }

    // æ˜¯å¦å·²ç»ç”Ÿæˆè¿‡åŠ¨æ€è·¯ç”±
    if (accessStore.isAccessChecked) {
      return true;
    }

    // ç”Ÿæˆè·¯ç”±è¡¨
    // å½“å‰ç™»å½•ç”¨æˆ·æ‹¥æœ‰çš„è§’è‰²æ ‡è¯†åˆ—è¡¨
    const userInfo = userStore.userInfo || (await authStore.fetchUserInfo());
    const userRoles = userInfo.roles ?? [];

    // ç”Ÿæˆèœå•å’Œè·¯ç”±
    const { accessibleMenus, accessibleRoutes } = await generateAccess({
      roles: userRoles,
      router,
      routes: accessRoutes,
    });

    // ä¿å­˜èœå•ä¿¡æ¯å’Œè·¯ç”±ä¿¡æ¯
    accessStore.setAccessMenus(accessibleMenus);
    accessStore.setAccessRoutes(accessibleRoutes);
    accessStore.setIsAccessChecked(true);
    const redirectPath = (from.query.redirect ??
      (to.path === preferences.app.defaultHomePath
        ? userInfo.homePath || preferences.app.defaultHomePath
        : to.fullPath)) as string;

    return {
      ...router.resolve(decodeURIComponent(redirectPath)),
      replace: true,
    };
  });
}
```

### 2. è·¯ç”±æƒé™é…ç½®

**web-antd** é¡¹ç›®ä½¿ç”¨åç«¯æ¨¡å¼ï¼Œè·¯ç”±æƒé™ç”±åç«¯èœå•æ§åˆ¶ã€‚å¦‚éœ€é…ç½®å‰ç«¯è·¯ç”±æƒé™ï¼š

```typescript
// router/routes/modules/system.ts
import type { RouteRecordRaw } from 'vue-router';
import { $t } from '#/locales';

const routes: RouteRecordRaw[] = [
  {
    path: '/system/role',
    name: 'SystemRole',
    meta: {
      title: $t('system.role.title'),
      icon: 'mdi:account-group',
      // å‰ç«¯æ¨¡å¼æ—¶éœ€è¦é…ç½®ï¼ˆå½“å‰é¡¹ç›®ä½¿ç”¨åç«¯æ¨¡å¼ï¼Œä¸éœ€è¦ï¼‰
      // authority: ['admin', 'system:role:view'],
    },
    component: () => import('#/views/system/role/list.vue'),
  },
];
```

### 3. è·¯ç”±æƒé™åˆ¤æ–­é€»è¾‘

**å‰ç«¯æ¨¡å¼**ï¼ˆ`accessMode: 'frontend'`ï¼‰ï¼š
- æ ¹æ®ç”¨æˆ·è§’è‰²ï¼ˆ`userRoles`ï¼‰è¿‡æ»¤è·¯ç”±
- ä½¿ç”¨ `hasAuthority` å‡½æ•°åˆ¤æ–­è·¯ç”±æ˜¯å¦æœ‰æƒé™

```typescript:36:44:packages/utils/src/helpers/generate-routes-frontend.ts
function hasAuthority(route: RouteRecordRaw, access: string[]) {
  const authority = route.meta?.authority;
  if (!authority) {
    return true;
  }
  const canAccess = access.some((value) => authority.includes(value));

  return canAccess || (!canAccess && menuHasVisibleWithForbidden(route));
}
```

**åç«¯æ¨¡å¼**ï¼ˆ`accessMode: 'backend'`ï¼‰ï¼š
- ä»åç«¯è·å–èœå•åˆ—è¡¨
- åç«¯è¿”å›çš„èœå•å³ä¸ºå¯è®¿é—®çš„è·¯ç”±

### 4. ç‰¹æ®Šè·¯ç”±é…ç½®

- **`ignoreAccess: true`**ï¼šå¿½ç•¥æƒé™æ£€æŸ¥ï¼Œç›´æ¥å¯è®¿é—®
- **`menuVisibleWithForbidden: true`**ï¼šèœå•å¯è§ï¼Œä½†è®¿é—®æ—¶è·³è½¬åˆ° 403 é¡µé¢
- **æ ¸å¿ƒè·¯ç”±**ï¼šç™»å½•ã€404 ç­‰åŸºç¡€è·¯ç”±ï¼Œä¸èµ°æƒé™æ‹¦æˆª

---

## æŒ‰é’®æƒé™è®¾è®¡

### 1. æƒé™æŒ‡ä»¤ `v-access`

æ¡†æ¶æä¾›äº† `v-access` æŒ‡ä»¤ç”¨äºæ§åˆ¶æŒ‰é’®/ç»„ä»¶çš„æ˜¾ç¤ºã€‚**web-antd** é¡¹ç›®ä¸»è¦ä½¿ç”¨åŸºäºæƒé™ç çš„æ§åˆ¶ï¼š

```vue
<script setup lang="ts">
import { Button } from 'ant-design-vue';
import { SYSTEM_PERMISSION_CODES } from '#/constants/permission-codes';
import { Plus } from '@vben/icons';
import { $t } from '#/locales';

// æƒé™æŒ‡ä»¤ä¼šè‡ªåŠ¨æ³¨å†Œï¼Œæ— éœ€æ‰‹åŠ¨å¯¼å…¥
</script>

<template>
  <!-- åŸºäºæƒé™ç æ§åˆ¶ï¼ˆæ¨èï¼‰ -->
  <a-button
    v-access:code="SYSTEM_PERMISSION_CODES.USER.ADD"
    type="primary"
    @click="handleAdd"
  >
    <Plus class="size-5" />
    {{ $t('ui.actionTitle.create', [$t('system.user.name')]) }}
  </a-button>

  <!-- ä¹Ÿå¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²æƒé™ç  -->
  <a-button v-access:code="'ac:system:user:edit'">ç¼–è¾‘</a-button>

  <!-- åŸºäºè§’è‰²æ§åˆ¶ï¼ˆè¾ƒå°‘ä½¿ç”¨ï¼‰ -->
  <a-button v-access:role="'admin'">ç®¡ç†å‘˜æŒ‰é’®</a-button>
</template>
```

**å®é™…é¡¹ç›®ç¤ºä¾‹**ï¼ˆ`apps/web-antd/src/views/system/user/list.vue`ï¼‰ï¼š

```vue
<template>
  <Grid :table-title="$t('system.user.list')">
    <template #toolbar-tools>
      <Button
        v-access:code="SYSTEM_PERMISSION_CODES.USER.ADD"
        type="primary"
        @click="onCreate"
      >
        <Plus class="size-5" />
        {{ $t('ui.actionTitle.create', [$t('system.user.name')]) }}
      </Button>
    </template>
  </Grid>
</template>
```

### 2. æƒé™æŒ‡ä»¤å®ç°

```typescript:11:30:packages/effects/access/src/directive.ts
function isAccessible(
  el: Element,
  binding: DirectiveBinding<string | string[]>,
) {
  const { accessMode, hasAccessByCodes, hasAccessByRoles } = useAccess();

  const value = binding.value;

  if (!value) return;
  const authMethod =
    accessMode.value === 'frontend' && binding.arg === 'role'
      ? hasAccessByRoles
      : hasAccessByCodes;

  const values = Array.isArray(value) ? value : [value];

  if (!authMethod(values)) {
    el?.remove();
  }
}
```

**å·¥ä½œåŸç†**ï¼š
1. æ ¹æ® `accessMode` å’ŒæŒ‡ä»¤å‚æ•°ï¼ˆ`role`/`code`ï¼‰é€‰æ‹©æƒé™åˆ¤æ–­æ–¹æ³•
2. å¦‚æœç”¨æˆ·æ²¡æœ‰æƒé™ï¼Œç›´æ¥ç§»é™¤ DOM å…ƒç´ 

### 3. AccessControl ç»„ä»¶

é™¤äº†æŒ‡ä»¤ï¼Œè¿˜æä¾›äº† `AccessControl` ç»„ä»¶ï¼ˆè¾ƒå°‘ä½¿ç”¨ï¼‰ï¼š

```vue
<script setup lang="ts">
import { AccessControl } from '@vben/access';
import { Button } from 'ant-design-vue';
import { SYSTEM_PERMISSION_CODES } from '#/constants/permission-codes';
</script>

<template>
  <AccessControl :codes="[SYSTEM_PERMISSION_CODES.USER.ADD]" type="code">
    <a-button type="primary">æ·»åŠ ç”¨æˆ·</a-button>
  </AccessControl>
</template>
```

---

## è¡¨æ ¼æ“ä½œæŒ‰é’®æƒé™

**web-antd** é¡¹ç›®ä¸­ï¼Œè¡¨æ ¼æ“ä½œæŒ‰é’®çš„æƒé™æ§åˆ¶é€šè¿‡ `usePermissions` hook åœ¨ `data.ts` æ–‡ä»¶ä¸­é…ç½®ï¼š

### 1. åœ¨ data.ts ä¸­é…ç½®æ“ä½œæŒ‰é’®æƒé™

```typescript
// views/system/user/data.ts
import { usePermissions } from '#/hooks/use-permissions';
import { SYSTEM_PERMISSION_CODES } from '#/constants/permission-codes';

export function useColumns<T = SystemUserApi.SystemUser>(
  onActionClick: OnActionClickFn<T>,
): VxeTableGridOptions['columns'] {
  const { hasPermission } = usePermissions(SYSTEM_PERMISSION_CODES.USER);

  // å®šä¹‰æ“ä½œæŒ‰é’®é…ç½®åŠå¯¹åº”çš„æƒé™æ£€æŸ¥æ–¹æ³•
  const operationButtons = [
    {
      code: 'edit',
      text: $t('common.edit'),
      hasAccess: hasPermission.EDIT, // ä½¿ç”¨æƒé™æ£€æŸ¥æ–¹æ³•
    },
    {
      code: 'resetPassword',
      text: $t('system.user.resetPassword'),
      hasAccess: hasPermission.EDIT, // é‡ç½®å¯†ç ä½¿ç”¨ç¼–è¾‘æƒé™
    },
    {
      code: 'delete',
      text: $t('common.delete'),
      hasAccess: hasPermission.DELETE,
    },
  ];

  // æ ¹æ®æƒé™è¿‡æ»¤æ“ä½œæŒ‰é’®
  const filteredOperations = operationButtons
    .filter((btn) => {
      // å¦‚æœæ²¡æœ‰é…ç½®æƒé™æ£€æŸ¥æ–¹æ³•ï¼Œåˆ™é»˜è®¤æ˜¾ç¤º
      if (!btn.hasAccess) {
        return true;
      }
      // æ£€æŸ¥æ˜¯å¦æœ‰å¯¹åº”æƒé™
      return btn.hasAccess();
    })
    .map((btn) => {
      // ç§»é™¤ hasAccessï¼Œåªä¿ç•™éœ€è¦çš„å±æ€§
      const { hasAccess: _hasAccess, ...rest } = btn;
      return rest;
    });

  return [
    // ... å…¶ä»–åˆ—é…ç½®
    {
      title: $t('common.action'),
      width: 200,
      fixed: 'right',
      slots: { default: 'action' },
      // ä½¿ç”¨è¿‡æ»¤åçš„æ“ä½œæŒ‰é’®é…ç½®
      actionButtons: filteredOperations,
    },
  ];
}
```

### 2. åœ¨ list.vue ä¸­ä½¿ç”¨

```vue
<script setup lang="ts">
import { useColumns } from './data';

const [Grid, gridApi] = useVbenVxeGrid({
  gridOptions: {
    columns: useColumns(onActionClick), // ä¼ å…¥æ“ä½œå›è°ƒ
  },
});

function onActionClick({ code, row }: OnActionClickParams) {
  switch (code) {
    case 'edit':
      // ç¼–è¾‘é€»è¾‘
      break;
    case 'delete':
      // åˆ é™¤é€»è¾‘
      break;
  }
}
</script>

<template>
  <Grid />
</template>
```

**ä¼˜åŠ¿**ï¼š
- âœ… æƒé™æ£€æŸ¥é€»è¾‘é›†ä¸­åœ¨ `data.ts` ä¸­ï¼Œä¾¿äºç»´æŠ¤
- âœ… æ”¯æŒåŠ¨æ€æƒé™æ£€æŸ¥ï¼Œæƒé™å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°
- âœ… ç±»å‹å®‰å…¨ï¼ŒTypeScript æ”¯æŒè‰¯å¥½
- âœ… ä½¿ç”¨ `usePermissions` hookï¼Œä»£ç ç®€æ´

**å¯¹æ¯”ï¼šå¦‚æœç›´æ¥ä½¿ç”¨ `useAccess`**

```typescript
// âŒ ä¸æ¨èï¼šä»£ç å†—é•¿
import { useAccess } from '@vben/access';
import { SYSTEM_PERMISSION_CODES } from '#/constants/permission-codes';

const { hasAccessByCodes } = useAccess();

const operationButtons = [
  {
    code: 'edit',
    text: $t('common.edit'),
    hasAccess: () => hasAccessByCodes([SYSTEM_PERMISSION_CODES.USER.EDIT]),
  },
  {
    code: 'delete',
    text: $t('common.delete'),
    hasAccess: () => hasAccessByCodes([SYSTEM_PERMISSION_CODES.USER.DELETE]),
  },
];
```

```typescript
// âœ… æ¨èï¼šä½¿ç”¨ usePermissionsï¼Œä»£ç ç®€æ´
import { usePermissions } from '#/hooks/use-permissions';
import { SYSTEM_PERMISSION_CODES } from '#/constants/permission-codes';

const { hasPermission } = usePermissions(SYSTEM_PERMISSION_CODES.USER);

const operationButtons = [
  {
    code: 'edit',
    text: $t('common.edit'),
    hasAccess: hasPermission.EDIT,
  },
  {
    code: 'delete',
    text: $t('common.delete'),
    hasAccess: hasPermission.DELETE,
  },
];
```

---

## è§’è‰²æƒé™è®¾è®¡

### 1. è§’è‰²å­˜å‚¨

ç”¨æˆ·è§’è‰²å­˜å‚¨åœ¨ `useUserStore` ä¸­ï¼š

```typescript:24:61:packages/stores/src/modules/user.ts
interface AccessState {
  /**
   * ç”¨æˆ·ä¿¡æ¯
   */
  userInfo: BasicUserInfo | null;
  /**
   * ç”¨æˆ·è§’è‰²
   */
  userRoles: string[];
}

export const useUserStore = defineStore('core-user', {
  actions: {
    setUserInfo(userInfo: BasicUserInfo | null) {
      // è®¾ç½®ç”¨æˆ·ä¿¡æ¯
      this.userInfo = userInfo;
      // è®¾ç½®è§’è‰²ä¿¡æ¯
      const roles = userInfo?.roles ?? [];
      this.setUserRoles(roles);
    },
    setUserRoles(roles: string[]) {
      this.userRoles = roles;
    },
  },
  state: (): AccessState => ({
    userInfo: null,
    userRoles: [],
  }),
});
```

### 2. è§’è‰²æƒé™åˆ¤æ–­

é€šè¿‡ `useAccess` ç»„åˆå¼å‡½æ•°åˆ¤æ–­è§’è‰²æƒé™ï¼š

```typescript:18:22:packages/effects/access/src/use-access.ts
function hasAccessByRoles(roles: string[]) {
  const userRoleSet = new Set(userStore.userRoles);
  const intersection = roles.filter((item) => userRoleSet.has(item));
  return intersection.length > 0;
}
```

**åˆ¤æ–­é€»è¾‘**ï¼š
- ç”¨æˆ·è§’è‰²ä¸æ‰€éœ€è§’è‰²æœ‰äº¤é›† â†’ æœ‰æƒé™
- æ— äº¤é›† â†’ æ— æƒé™

### 3. è§’è‰²è·å–æµç¨‹

**web-antd** é¡¹ç›®çš„ç™»å½•æµç¨‹ï¼ˆ`apps/web-antd/src/store/auth.ts`ï¼‰ï¼š

```typescript
async function authLogin(
  params: Recordable<any>,
  onSuccess?: () => Promise<void> | void,
) {
  let userInfo: null | UserInfo = null;
  try {
    loginLoading.value = true;
    const { accessToken } = await loginApi(params);

    if (accessToken) {
      accessStore.setAccessToken(accessToken);

      // å¹¶è¡Œè·å–ç”¨æˆ·ä¿¡æ¯å’Œæƒé™ç 
      const [fetchUserInfoResult, accessCodes] = await Promise.all([
        fetchUserInfo(),
        getAccessCodesApi(),
      ]);

      userInfo = fetchUserInfoResult;

      // å­˜å‚¨ç”¨æˆ·ä¿¡æ¯å’Œæƒé™ç 
      userStore.setUserInfo(userInfo);
      accessStore.setAccessCodes(accessCodes);

      // ç™»å½•æˆåŠŸåçš„å¤„ç†
      if (accessStore.loginExpired) {
        accessStore.setLoginExpired(false);
      } else {
        onSuccess
          ? await onSuccess?.()
          : await router.push(
              userInfo.homePath || preferences.app.defaultHomePath,
            );
      }

      // æ˜¾ç¤ºç™»å½•æˆåŠŸé€šçŸ¥
      if (userInfo?.realName) {
        notification.success({
          description: `${$t('authentication.loginSuccessDesc')}:${userInfo?.realName}`,
          duration: 3,
          message: $t('authentication.loginSuccess'),
        });
      }
    }
  } finally {
    loginLoading.value = false;
  }

  return {
    userInfo,
  };
}
```

---

## æƒé™ç æƒé™è®¾è®¡

### 1. æƒé™ç å­˜å‚¨

æƒé™ç å­˜å‚¨åœ¨ `useAccessStore` ä¸­ï¼š

```typescript:7:46:packages/stores/src/modules/access.ts
interface AccessState {
  /**
   * æƒé™ç 
   */
  accessCodes: string[];
  /**
   * å¯è®¿é—®çš„èœå•åˆ—è¡¨
   */
  accessMenus: MenuRecordRaw[];
  /**
   * å¯è®¿é—®çš„è·¯ç”±åˆ—è¡¨
   */
  accessRoutes: RouteRecordRaw[];
  /**
   * ç™»å½• accessToken
   */
  accessToken: AccessToken;
  /**
   * æ˜¯å¦å·²ç»æ£€æŸ¥è¿‡æƒé™
   */
  isAccessChecked: boolean;
  // ...
}
```

### 2. æƒé™ç è·å–

é€šè¿‡ API è·å–ç”¨æˆ·æƒé™ç ï¼ˆ`apps/web-antd/src/api/core/auth.ts`ï¼‰ï¼š

```typescript
import { requestClient } from '#/api/request';

/**
 * è·å–ç”¨æˆ·æƒé™ç 
 * @returns æƒé™ç æ•°ç»„ï¼Œå¦‚ ['ac:system:user:view', 'ac:system:user:add', ...]
 */
export async function getAccessCodesApi() {
  return requestClient.get<string[]>('/auth/codes');
}
```

**ä½¿ç”¨æ—¶æœº**ï¼šåœ¨ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œä¸è·å–ç”¨æˆ·ä¿¡æ¯å¹¶è¡Œè°ƒç”¨ã€‚

### 3. æƒé™ç åˆ¤æ–­

```typescript:29:34:packages/effects/access/src/use-access.ts
function hasAccessByCodes(codes: string[]) {
  const userCodesSet = new Set(accessStore.accessCodes);

  const intersection = codes.filter((item) => userCodesSet.has(item));
  return intersection.length > 0;
}
```

**åˆ¤æ–­é€»è¾‘**ï¼š
- ç”¨æˆ·æƒé™ç ä¸æ‰€éœ€æƒé™ç æœ‰äº¤é›† â†’ æœ‰æƒé™
- æ— äº¤é›† â†’ æ— æƒé™

---

## æƒé™æ¨¡å¼ï¼ˆå‰ç«¯/åç«¯ï¼‰

### 1. å‰ç«¯æ¨¡å¼ï¼ˆ`accessMode: 'frontend'`ï¼‰

**ç‰¹ç‚¹**ï¼š
- è·¯ç”±é…ç½®åœ¨å‰ç«¯å®šä¹‰
- æ ¹æ®ç”¨æˆ·è§’è‰²è¿‡æ»¤è·¯ç”±
- èœå•æ ¹æ®è·¯ç”±è‡ªåŠ¨ç”Ÿæˆ

**é€‚ç”¨åœºæ™¯**ï¼š
- æƒé™ç›¸å¯¹å›ºå®š
- å‰ç«¯éœ€è¦å®Œå…¨æ§åˆ¶è·¯ç”±ç»“æ„

**é…ç½®**ï¼ˆ`apps/web-antd/src/preferences.ts`ï¼‰ï¼š
```typescript
import { defineOverridesPreferences } from '@vben/preferences';

export const overridesPreferences = defineOverridesPreferences({
  app: {
    accessMode: 'frontend', // å‰ç«¯æ¨¡å¼
  },
});
```

### 2. åç«¯æ¨¡å¼ï¼ˆ`accessMode: 'backend'`ï¼‰â­ å½“å‰ä½¿ç”¨

**web-antd** é¡¹ç›®å½“å‰ä½¿ç”¨**åç«¯æ¨¡å¼**ã€‚

**ç‰¹ç‚¹**ï¼š
- è·¯ç”±/èœå•ä»åç«¯è·å–
- åç«¯è¿”å›çš„èœå•å³ä¸ºå¯è®¿é—®çš„è·¯ç”±
- æ›´çµæ´»ï¼Œæƒé™å®Œå…¨ç”±åç«¯æ§åˆ¶

**é€‚ç”¨åœºæ™¯**ï¼š
- æƒé™åŠ¨æ€å˜åŒ–
- éœ€è¦åç«¯ç»Ÿä¸€ç®¡ç†æƒé™

**é…ç½®**ï¼ˆ`apps/web-antd/src/preferences.ts`ï¼‰ï¼š
```typescript
import { defineOverridesPreferences } from '@vben/preferences';

export const overridesPreferences = defineOverridesPreferences({
  app: {
    accessMode: 'backend', // åç«¯æ¨¡å¼ï¼ˆå½“å‰é…ç½®ï¼‰
  },
});
```

**åç«¯èœå• API**ï¼ˆ`apps/web-antd/src/api/core/menu.ts`ï¼‰ï¼š
```typescript
import type { RouteRecordStringComponent } from '@vben/types';
import { requestClient } from '#/api/request';

/**
 * è·å–ç”¨æˆ·æ‰€æœ‰èœå•
 * @returns åç«¯è¿”å›çš„èœå•åˆ—è¡¨ï¼ŒåŒ…å«è·¯ç”±ä¿¡æ¯
 */
export async function getAllMenusApi() {
  return requestClient.get<RouteRecordStringComponent[]>('/menu/all');
}
```

### 3. æƒé™ç”Ÿæˆé€»è¾‘

**web-antd** é¡¹ç›®çš„æƒé™ç”Ÿæˆé€»è¾‘ï¼ˆ`apps/web-antd/src/router/access.ts`ï¼‰ï¼š

```typescript
import type {
  ComponentRecordType,
  GenerateMenuAndRoutesOptions,
} from '@vben/types';

import { generateAccessible } from '@vben/access';
import { preferences } from '@vben/preferences';
import { message } from 'ant-design-vue';

import { getAllMenusApi } from '#/api';
import { BasicLayout, IFrameView } from '#/layouts';
import { $t } from '#/locales';

const forbiddenComponent = () => import('#/views/_core/fallback/forbidden.vue');

async function generateAccess(options: GenerateMenuAndRoutesOptions) {
  // åŠ¨æ€å¯¼å…¥æ‰€æœ‰é¡µé¢ç»„ä»¶
  const pageMap: ComponentRecordType = import.meta.glob('../views/**/*.vue');

  // å¸ƒå±€ç»„ä»¶æ˜ å°„
  const layoutMap: ComponentRecordType = {
    BasicLayout,
    IFrameView,
  };

  return await generateAccessible(preferences.app.accessMode, {
    ...options,
    fetchMenuListAsync: async () => {
      // æ˜¾ç¤ºåŠ è½½æç¤º
      message.loading({
        content: `${$t('common.loadingMenu')}...`,
        duration: 1.5,
      });
      // ä»åç«¯è·å–èœå•åˆ—è¡¨
      return await getAllMenusApi();
    },
    // 403 é¡µé¢ç»„ä»¶
    forbiddenComponent,
    // å¸ƒå±€ç»„ä»¶æ˜ å°„
    layoutMap,
    // é¡µé¢ç»„ä»¶æ˜ å°„
    pageMap,
  });
}

export { generateAccess };
```

---

## æ ¸å¿ƒç»„ä»¶ä¸ API

### 1. Store

#### `useAccessStore` - æƒé™çŠ¶æ€ç®¡ç†
- `accessToken`: ç™»å½•ä»¤ç‰Œ
- `accessCodes`: æƒé™ç åˆ—è¡¨
- `accessMenus`: å¯è®¿é—®èœå•
- `accessRoutes`: å¯è®¿é—®è·¯ç”±
- `isAccessChecked`: æ˜¯å¦å·²æ£€æŸ¥æƒé™

#### `useUserStore` - ç”¨æˆ·ä¿¡æ¯ç®¡ç†
- `userInfo`: ç”¨æˆ·ä¿¡æ¯
- `userRoles`: ç”¨æˆ·è§’è‰²åˆ—è¡¨

#### `useAuthStore` - è®¤è¯ç®¡ç†
- `authLogin()`: ç™»å½•
- `logout()`: ç™»å‡º
- `fetchUserInfo()`: è·å–ç”¨æˆ·ä¿¡æ¯

### 2. ç»„åˆå¼å‡½æ•°

#### `useAccess()` - æƒé™åˆ¤æ–­å·¥å…·ï¼ˆåº•å±‚ APIï¼‰

```typescript
import { useAccess } from '@vben/access';

const {
  accessMode,          // æƒé™æ¨¡å¼ï¼ˆ'frontend' | 'backend'ï¼‰
  hasAccessByCodes,   // åŸºäºæƒé™ç åˆ¤æ–­
  hasAccessByRoles,    // åŸºäºè§’è‰²åˆ¤æ–­
  toggleAccessMode,    // åˆ‡æ¢æƒé™æ¨¡å¼
} = useAccess();
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- éœ€è¦æ£€æŸ¥å¤šä¸ªæƒé™ç æˆ–è§’è‰²
- éœ€è¦åŠ¨æ€æƒé™åˆ¤æ–­é€»è¾‘

#### `usePermissions()` - æƒé™ç®¡ç† Hookï¼ˆæ¨èä½¿ç”¨ï¼‰â­

**web-antd** é¡¹ç›®æä¾›çš„æƒé™ç®¡ç† Hookï¼ˆ`apps/web-antd/src/hooks/use-permissions.ts`ï¼‰ï¼š

```typescript
import { usePermissions } from '#/hooks/use-permissions';
import { SYSTEM_PERMISSION_CODES } from '#/constants/permission-codes';

// ä½¿ç”¨ç¤ºä¾‹
const { permissionCodes, hasPermission } = usePermissions(
  SYSTEM_PERMISSION_CODES.USER,
);

// permissionCodes: { VIEW: 'ac:system:user:view', ADD: 'ac:system:user:add', ... }
// hasPermission: { VIEW: () => boolean, ADD: () => boolean, ... }

// æ£€æŸ¥æƒé™
if (hasPermission.ADD()) {
  // æœ‰æ–°å¢æƒé™
}
```

**ä¼˜åŠ¿**ï¼š
- âœ… ç±»å‹å®‰å…¨ï¼Œè‡ªåŠ¨æ¨æ–­æƒé™ç ç±»å‹
- âœ… ä½¿ç”¨æ–¹ä¾¿ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨ `hasAccessByCodes`
- âœ… ä»£ç ç®€æ´ï¼Œç»Ÿä¸€ç®¡ç†æƒé™æ£€æŸ¥é€»è¾‘
- âœ… é€‚åˆè¡¨æ ¼æ“ä½œæŒ‰é’®æƒé™é…ç½®

**å®ç°åŸç†**ï¼šå†…éƒ¨ä½¿ç”¨ `useAccess` çš„ `hasAccessByCodes` æ–¹æ³•

### 3. API

**web-antd** é¡¹ç›®çš„æƒé™ç›¸å…³ APIï¼ˆ`apps/web-antd/src/api/core/`ï¼‰ï¼š

```typescript
// å¯¼å…¥ API å‡½æ•°
import {
  loginApi,
  getUserInfoApi,
  getAccessCodesApi,
  getAllMenusApi,
  logoutApi,
} from '#/api';

// API å‡½æ•°è¯´æ˜
// - loginApi(params): ç™»å½•ï¼Œè¿”å› { accessToken: string }
// - getUserInfoApi(): è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œè¿”å› UserInfoï¼ˆåŒ…å« rolesï¼‰
// - getAccessCodesApi(): è·å–æƒé™ç åˆ—è¡¨ï¼Œè¿”å› string[]
// - getAllMenusApi(): è·å–æ‰€æœ‰èœå•ï¼ˆåç«¯æ¨¡å¼ï¼‰ï¼Œè¿”å› RouteRecordStringComponent[]
// - logoutApi(): é€€å‡ºç™»å½•
```

**API æ–‡ä»¶ä½ç½®**ï¼š
- `apps/web-antd/src/api/core/auth.ts` - è®¤è¯ç›¸å…³ API
- `apps/web-antd/src/api/core/menu.ts` - èœå•ç›¸å…³ API

---

## å®é™…ä½¿ç”¨ç¤ºä¾‹

### 1. è·¯ç”±æƒé™é…ç½®

**web-antd** é¡¹ç›®ä½¿ç”¨åç«¯æ¨¡å¼ï¼Œè·¯ç”±æƒé™ç”±åç«¯èœå•æ§åˆ¶ã€‚å¦‚éœ€é…ç½®å‰ç«¯è·¯ç”±æƒé™ï¼š

```typescript
// router/routes/modules/system.ts
import type { RouteRecordRaw } from 'vue-router';
import { $t } from '#/locales';

const routes: RouteRecordRaw[] = [
  {
    path: '/system/role',
    name: 'SystemRole',
    meta: {
      title: $t('system.role.title'),
      icon: 'mdi:account-group',
      // å‰ç«¯æ¨¡å¼æ—¶éœ€è¦é…ç½®ï¼ˆå½“å‰é¡¹ç›®ä½¿ç”¨åç«¯æ¨¡å¼ï¼Œä¸éœ€è¦ï¼‰
      // authority: ['admin', 'system:role:view'],
    },
    component: () => import('#/views/system/role/list.vue'),
  },
];
```

### 2. æŒ‰é’®æƒé™æ§åˆ¶ï¼ˆä½¿ç”¨ v-access æŒ‡ä»¤ï¼‰

**å®é™…é¡¹ç›®ç¤ºä¾‹**ï¼ˆ`apps/web-antd/src/views/system/user/list.vue`ï¼‰ï¼š

```vue
<script setup lang="ts">
import { Button } from 'ant-design-vue';
import { SYSTEM_PERMISSION_CODES } from '#/constants/permission-codes';
import { Plus } from '@vben/icons';
import { $t } from '#/locales';

function onCreate() {
  // æ–°å¢é€»è¾‘
}
</script>

<template>
  <Grid :table-title="$t('system.user.list')">
    <template #toolbar-tools>
      <Button
        v-access:code="SYSTEM_PERMISSION_CODES.USER.ADD"
        type="primary"
        @click="onCreate"
      >
        <Plus class="size-5" />
        {{ $t('ui.actionTitle.create', [$t('system.user.name')]) }}
      </Button>
    </template>
  </Grid>
</template>
```

### 3. è¡¨æ ¼æ“ä½œæŒ‰é’®æƒé™ï¼ˆä½¿ç”¨ usePermissionsï¼‰

**å®é™…é¡¹ç›®ç¤ºä¾‹**ï¼ˆ`apps/web-antd/src/views/system/user/data.ts`ï¼‰ï¼š

```typescript
import { usePermissions } from '#/hooks/use-permissions';
import { SYSTEM_PERMISSION_CODES } from '#/constants/permission-codes';

export function useColumns<T = SystemUserApi.SystemUser>(
  onActionClick: OnActionClickFn<T>,
): VxeTableGridOptions['columns'] {
  const { hasPermission } = usePermissions(SYSTEM_PERMISSION_CODES.USER);

  const operationButtons = [
    {
      code: 'edit',
      text: $t('common.edit'),
      hasAccess: hasPermission.EDIT,
    },
    {
      code: 'delete',
      text: $t('common.delete'),
      hasAccess: hasPermission.DELETE,
    },
  ];

  // æ ¹æ®æƒé™è¿‡æ»¤æ“ä½œæŒ‰é’®
  const filteredOperations = operationButtons
    .filter((btn) => btn.hasAccess?.() ?? true)
    .map(({ hasAccess: _, ...rest }) => rest);

  return [
    // ... å…¶ä»–åˆ—
    {
      title: $t('common.action'),
      width: 200,
      fixed: 'right',
      slots: { default: 'action' },
      actionButtons: filteredOperations,
    },
  ];
}
```

### 4. ç¼–ç¨‹å¼æƒé™åˆ¤æ–­

**æ–¹å¼ä¸€ï¼šä½¿ç”¨ `usePermissions`ï¼ˆæ¨èï¼‰**

```vue
<script setup lang="ts">
import { message } from 'ant-design-vue';
import { usePermissions } from '#/hooks/use-permissions';
import { SYSTEM_PERMISSION_CODES } from '#/constants/permission-codes';

const { hasPermission } = usePermissions(SYSTEM_PERMISSION_CODES.USER);

function handleAction() {
  if (!hasPermission.ADD()) {
    message.warning('æ‚¨æ²¡æœ‰æ·»åŠ æƒé™');
    return;
  }
  // æ‰§è¡Œæ“ä½œ
}
</script>
```

**æ–¹å¼äºŒï¼šç›´æ¥ä½¿ç”¨ `useAccess`**

```vue
<script setup lang="ts">
import { message } from 'ant-design-vue';
import { useAccess } from '@vben/access';
import { SYSTEM_PERMISSION_CODES } from '#/constants/permission-codes';

const { hasAccessByCodes } = useAccess();

function handleAction() {
  if (!hasAccessByCodes([SYSTEM_PERMISSION_CODES.USER.ADD])) {
    message.warning('æ‚¨æ²¡æœ‰æ·»åŠ æƒé™');
    return;
  }
  // æ‰§è¡Œæ“ä½œ
}
</script>
```

---

## æ€»ç»“

**web-antd** é¡¹ç›®çš„æƒé™ç³»ç»Ÿè®¾è®¡ç‰¹ç‚¹ï¼š

1. **å¤šå±‚çº§æ§åˆ¶**ï¼šè·¯ç”±ã€æŒ‰é’®ã€è¡¨æ ¼æ“ä½œã€è§’è‰²ã€æƒé™ç å¤šä¸ªç»´åº¦
2. **æƒé™ç ç®¡ç†**ï¼šç»Ÿä¸€çš„æƒé™ç å¸¸é‡ï¼ˆ`SYSTEM_PERMISSION_CODES`ï¼‰ï¼Œæ ¼å¼ä¸º `ac:module:resource:action`
3. **çµæ´»é…ç½®**ï¼šæ”¯æŒå‰ç«¯å’Œåç«¯ä¸¤ç§æƒé™æ¨¡å¼ï¼ˆå½“å‰ä½¿ç”¨åç«¯æ¨¡å¼ï¼‰
4. **æ˜“äºä½¿ç”¨**ï¼š
   - `v-access:code` æŒ‡ä»¤ç”¨äºæŒ‰é’®æƒé™æ§åˆ¶
   - `usePermissions` hook ç”¨äºè¡¨æ ¼æ“ä½œæŒ‰é’®æƒé™æ§åˆ¶ï¼ˆæ¨èï¼‰
   - `useAccess` hook ç”¨äºåº•å±‚æƒé™åˆ¤æ–­ï¼ˆç‰¹æ®Šåœºæ™¯ï¼‰
5. **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
6. **è‡ªåŠ¨è¿‡æ»¤**ï¼šè·¯ç”±å’Œèœå•è‡ªåŠ¨æ ¹æ®æƒé™è¿‡æ»¤

### æƒé™ç³»ç»Ÿæ ¸å¿ƒæµç¨‹

1. ç”¨æˆ·ç™»å½• â†’ è·å– `accessToken`
2. å¹¶è¡Œè·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆåŒ…å« `roles`ï¼‰å’Œæƒé™ç åˆ—è¡¨ï¼ˆ`accessCodes`ï¼‰
3. è·¯ç”±å®ˆå«æ‹¦æˆªï¼ˆ`router/guard.ts`ï¼‰
4. æ ¹æ®æƒé™æ¨¡å¼ç”Ÿæˆå¯è®¿é—®è·¯ç”±ï¼š
   - **å‰ç«¯æ¨¡å¼**ï¼šæ ¹æ® `roles` è¿‡æ»¤å‰ç«¯è·¯ç”±
   - **åç«¯æ¨¡å¼**ï¼šä»åç«¯è·å–èœå•åˆ—è¡¨ï¼ˆå½“å‰ä½¿ç”¨ï¼‰
5. ç”Ÿæˆå¯è®¿é—®èœå•
6. é¡µé¢æ¸²æŸ“ â†’ æŒ‰é’®/ç»„ä»¶æƒé™æ£€æŸ¥ï¼š
   - ä½¿ç”¨ `v-access:code` æŒ‡ä»¤
   - ä½¿ç”¨ `usePermissions` hook æ£€æŸ¥è¡¨æ ¼æ“ä½œæƒé™

### æœ€ä½³å®è·µ

1. âœ… **ä½¿ç”¨æƒé™ç å¸¸é‡**ï¼šä½¿ç”¨ `SYSTEM_PERMISSION_CODES` è€Œä¸æ˜¯ç¡¬ç¼–ç å­—ç¬¦ä¸²
2. âœ… **ä½¿ç”¨ usePermissions**ï¼šè¡¨æ ¼æ“ä½œæŒ‰é’®ä½¿ç”¨ `usePermissions` hookï¼ˆæ¨èï¼‰
3. âœ… **ä½¿ç”¨ v-access æŒ‡ä»¤**ï¼šé¡µé¢æŒ‰é’®ä½¿ç”¨ `v-access:code` æŒ‡ä»¤
4. âœ… **ç»Ÿä¸€æƒé™ç æ ¼å¼**ï¼šéµå¾ª `ac:module:resource:action` æ ¼å¼
5. âœ… **ç±»å‹å®‰å…¨**ï¼šå……åˆ†åˆ©ç”¨ TypeScript ç±»å‹æ£€æŸ¥
6. âœ… **åˆç†é€‰æ‹©æ–¹å¼**ï¼š
   - è¡¨æ ¼æ“ä½œæŒ‰é’® â†’ `usePermissions`ï¼ˆæ¨èï¼‰
   - é¡µé¢æŒ‰é’® â†’ `v-access:code` æŒ‡ä»¤
   - éœ€è¦æ£€æŸ¥å¤šä¸ªæƒé™ç  â†’ `useAccess`ï¼ˆåº•å±‚ APIï¼‰
