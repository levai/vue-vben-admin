# Vue Vben Admin Cursor AI 规则

你是一位专业的 Vue 3 + TypeScript 开发专家，专注于 Vue Vben Admin 5.x 项目开发。

## 项目概述

- **项目**: Vue Vben Admin 5.x - 基于 Vue 3 + Vite + TypeScript 的现代化中后台管理系统
- **架构**: Monorepo (pnpm workspace + Turbo)
- **核心技术栈**: Vue 3.5+, Vite 6+, TypeScript 5+, Pinia, Vue Router
- **UI 框架**: Element Plus (当前项目使用)
- **样式方案**: TailwindCSS + PostCSS
- **包管理**: pnpm 10+ (必须使用 pnpm)
- **官方文档**: 遇到问题或需要了解详细功能时，可参考 `docs/src/guide/` 目录下的官方文档

## 核心开发原则

### 1. 代码质量标准

- **类型安全优先**: 所有代码必须有完整的 TypeScript 类型定义，禁止使用 `any`
- **组合式 API**: 统一使用 Vue 3 Composition API，禁止使用 Options API
- **代码完整性**: 代码必须完整可运行，禁止使用 TODO、占位符或省略代码
- **导入规范**: 确保所有导入路径正确，使用项目配置的路径别名

### 2. 编码规范

#### TypeScript 规范
```typescript
// ✅ 正确：使用明确的类型定义
interface UserInfo {
  id: string;
  username: string;
  roles: string[];
}

const fetchUser = async (id: string): Promise<UserInfo> => {
  // ...
}

// ❌ 错误：使用 any 或缺少类型
const fetchUser = async (id) => {
  // ...
}
```

#### Vue 组件规范
```vue
<script setup lang="ts">
// ✅ 正确：使用 Composition API + TypeScript
import { ref, computed } from 'vue';

interface Props {
  title: string;
  count?: number;
}

const props = withDefaults(defineProps<Props>(), {
  count: 0,
});

const emit = defineEmits<{
  update: [value: number];
}>();

const localCount = ref(props.count);
</script>

<template>
  <div>{{ title }}</div>
</template>
```

#### 命名规范
- **组件文件**: PascalCase (例: `UserProfile.vue`, `DataTable.vue`)
- **工具文件**: camelCase (例: `formatUtils.ts`, `dateHelper.ts`)
- **常量文件**: UPPER_CASE (例: `API_BASE_URL`, `MAX_RETRY_COUNT`)
- **类型/接口**: PascalCase (例: `UserInfo`, `ApiResponse`)
- **变量/函数**: camelCase (例: `userData`, `fetchUserList`)

### 3. 路径别名规范

```typescript
// 应用级别路径别名
import { useUserStore } from '@/store/user';
import UserList from '@/views/user/UserList.vue';

// Workspace 包路径别名
import { usePreferences } from '@vben/preferences';
import { requestClient } from '@vben/request';
import { VbenButton } from '@vben/common-ui';
```

### 4. 状态管理规范 (Pinia)

```typescript
import { defineStore } from 'pinia';
import { ref, computed } from 'vue';

export const useUserStore = defineStore('user', () => {
  // State
  const userInfo = ref<UserInfo | null>(null);
  const token = ref<string>('');

  // Getters
  const isLoggedIn = computed(() => !!token.value);
  const userName = computed(() => userInfo.value?.username ?? '');

  // Actions
  const setUserInfo = (info: UserInfo) => {
    userInfo.value = info;
  };

  const logout = async () => {
    userInfo.value = null;
    token.value = '';
  };

  return {
    userInfo,
    token,
    isLoggedIn,
    userName,
    setUserInfo,
    logout,
  };
});
```

### 5. API 请求规范

```typescript
import { requestClient } from '@vben/request';

// 定义响应类型
interface ApiResponse<T> {
  code: number;
  data: T;
  message: string;
}

interface UserListParams {
  page: number;
  pageSize: number;
  keyword?: string;
}

// API 函数
export const getUserList = async (params: UserListParams) => {
  return requestClient.get<ApiResponse<UserInfo[]>>('/api/user/list', {
    params,
  });
};

export const createUser = async (data: Partial<UserInfo>) => {
  return requestClient.post<ApiResponse<UserInfo>>('/api/user/create', data);
};
```

### 6. 路由配置规范

```typescript
import type { RouteRecordRaw } from 'vue-router';

const routes: RouteRecordRaw[] = [
  {
    path: '/user',
    name: 'User',
    component: () => import('@/views/user/index.vue'),
    meta: {
      title: '用户管理',
      icon: 'lucide:users',
      order: 1,
      // 权限控制
      authority: ['user:view'],
    },
    children: [
      {
        path: 'list',
        name: 'UserList',
        component: () => import('@/views/user/list.vue'),
        meta: {
          title: '用户列表',
          icon: 'lucide:list',
        },
      },
    ],
  },
];

export default routes;
```

### 7. 样式规范

```vue
<template>
  <!-- ✅ 优先使用 TailwindCSS 工具类 -->
  <div class="flex items-center justify-between px-4 py-2 bg-white rounded-lg shadow-md">
    <span class="text-lg font-semibold text-gray-900">{{ title }}</span>
    <button class="px-4 py-2 text-white bg-blue-500 rounded hover:bg-blue-600">
      操作
    </button>
  </div>
</template>

<style scoped>
/* 仅在必要时使用 scoped 样式 */
.custom-component {
  /* 自定义样式 */
}
</style>
```

## 组件使用优先级

在开发过程中，请遵循以下组件选择优先级：

**1. Vben 自定义组件（最优先）** → **2. Element Plus 组件（次选）** → **3. 原生 HTML（最后）**

### 为什么优先使用 Vben 组件？

- ✅ 统一的 API 设计，跨 UI 框架兼容
- ✅ 内置表单验证、状态管理
- ✅ 更好的 TypeScript 支持
- ✅ 符合项目架构设计

## Vben 自定义组件使用规范

框架提供了一套基于 TailwindCSS 的自定义组件，可适配不同 UI 框架。这些组件是**首选**，具有更好的一致性和扩展性。

### 1. Vben Form 表单（优先使用）

使用 `useVbenForm` 创建表单，底层基于 [vee-validate](https://vee-validate.logaretm.com/v4/)，支持强大的表单验证。

```vue
<script setup lang="ts">
import { useVbenForm } from '#/adapter/form';

// 定义表单 Schema
const [Form, formApi] = useVbenForm({
  // 表单配置
  commonConfig: {
    labelWidth: 100,
  },
  // 表单项配置
  schema: [
    {
      component: 'Input',
      fieldName: 'username',
      label: '用户名',
      rules: 'required',
    },
    {
      component: 'InputPassword',
      fieldName: 'password',
      label: '密码',
      rules: 'required',
    },
  ],
  // 提交处理
  handleSubmit: async (values) => {
    console.log('表单值:', values);
    await loginApi(values);
  },
});
</script>

<template>
  <Form />
</template>
```

#### 表单校验规则

```typescript
import { z } from '#/adapter/form';

// 预定义规则
{
  rules: 'required', // 必填
}

{
  rules: 'selectRequired', // 下拉必选
}

// Zod 复杂校验
{
  rules: z.string().email().min(5, { message: '邮箱格式不正确' }),
}

{
  rules: z.string().refine((value) => value.length >= 6, {
    message: '密码长度不能少于 6 位',
  }),
}
```

#### 表单联动

```typescript
{
  fieldName: 'city',
  component: 'Select',
  label: '城市',
  dependencies: {
    // 触发字段
    triggerFields: ['province'],
    // 动态显示
    show: (values) => !!values.province,
    // 动态禁用
    disabled: (values) => !values.province,
    // 动态组件参数
    componentProps: (values, formApi) => {
      return {
        options: getCityOptions(values.province),
      };
    },
  },
}
```

#### FormApi 常用方法

```typescript
// 提交表单
await formApi.submitForm();

// 设置表单值
await formApi.setValues({ username: 'admin' });

// 获取表单值
const values = await formApi.getValues();

// 重置表单
await formApi.resetForm();

// 校验表单
await formApi.validate();

// 更新 Schema
formApi.updateSchema([...newSchema]);
```

### 2. Vben Modal 模态框（优先使用）

使用 `useVbenModal` 创建模态框，支持拖拽、全屏、自动高度等功能。

```vue
<script setup lang="ts">
import { useVbenModal } from '@vben/common-ui';

const [Modal, modalApi] = useVbenModal({
  title: '编辑用户',
  // 开启拖拽
  draggable: true,
  // 确认回调
  onConfirm: async () => {
    const data = modalApi.getData();
    await saveUser(data);
  },
});

const handleOpen = () => {
  modalApi.setData({ id: 1, name: 'John' });
  modalApi.open();
};
</script>

<template>
  <el-button @click="handleOpen">打开弹窗</el-button>

  <Modal>
    <div>弹窗内容</div>
  </Modal>
</template>
```

#### 组件抽离模式

```vue
<script setup lang="ts">
import { useVbenModal } from '@vben/common-ui';
import UserForm from './UserForm.vue';

// 通过 connectedComponent 连接内部组件
const [Modal, modalApi] = useVbenModal({
  title: '编辑用户',
  connectedComponent: UserForm,
  onOpenChange: (isOpen) => {
    if (isOpen) {
      // 打开时设置数据
      modalApi.setData({ id: 1, name: 'John' });
    }
  },
});
</script>

<template>
  <Modal />
</template>
```

#### ModalApi 常用方法

```typescript
// 打开弹窗
modalApi.open();

// 关闭弹窗
modalApi.close();

// 设置共享数据
modalApi.setData({ id: 1, name: 'John' });

// 获取共享数据
const data = modalApi.getData();

// 动态更新状态
modalApi.setState({ title: '新标题', loading: true });

// 锁定弹窗（提交中状态）
modalApi.lock(true);
modalApi.unlock();
```

### 3. Vben Drawer 抽屉（优先使用）

使用 `useVbenDrawer` 创建抽屉，API 与 Modal 类似。

```vue
<script setup lang="ts">
import { useVbenDrawer } from '@vben/common-ui';

const [Drawer, drawerApi] = useVbenDrawer({
  title: '用户详情',
  // 抽屉位置
  placement: 'right',
  // 宽度
  class: 'w-[600px]',
  onConfirm: async () => {
    await saveData();
  },
});
</script>

<template>
  <Drawer>
    <div>抽屉内容</div>
  </Drawer>
</template>
```

### 4. Vben Vxe Table 表格（优先使用）

使用 `useVbenVxeGrid` 创建表格，基于 [vxe-table](https://vxetable.cn/)，支持虚拟滚动、树形表格、单元格编辑等。

```vue
<script setup lang="ts">
import { useVbenVxeGrid } from '#/adapter/vxe-table';

const [Grid, gridApi] = useVbenVxeGrid({
  // 表格配置
  gridOptions: {
    columns: [
      { field: 'id', title: 'ID', width: 80 },
      { field: 'username', title: '用户名' },
      { field: 'email', title: '邮箱' },
      {
        title: '操作',
        width: 200,
        slots: { default: 'action' },
      },
    ],
    // 代理配置
    proxyConfig: {
      ajax: {
        query: async ({ page }) => {
          const response = await getUserList({
            page: page.currentPage,
            pageSize: page.pageSize,
          });
          return {
            items: response.data,
            total: response.total,
          };
        },
      },
    },
  },
  // 搜索表单配置
  formOptions: {
    schema: [
      {
        fieldName: 'username',
        label: '用户名',
        component: 'Input',
      },
      {
        fieldName: 'status',
        label: '状态',
        component: 'Select',
        componentProps: {
          options: [
            { label: '启用', value: 1 },
            { label: '禁用', value: 0 },
          ],
        },
      },
    ],
  },
});

const handleDelete = async (row: any) => {
  await deleteUser(row.id);
  gridApi.reload();
};
</script>

<template>
  <Grid>
    <template #action="{ row }">
      <el-button type="primary" link size="small">编辑</el-button>
      <el-button type="danger" link size="small" @click="handleDelete(row)">
        删除
      </el-button>
    </template>
  </Grid>
</template>
```

#### GridApi 常用方法

```typescript
// 重载表格（初始化）
gridApi.reload();

// 查询表格（保留分页）
gridApi.query();

// 设置 loading
gridApi.setLoading(true);

// 访问 vxe-table 实例
gridApi.grid.getTableData();

// 访问表单 API
gridApi.formApi.setValues({ username: 'admin' });

// 切换搜索表单显示
gridApi.toggleSearchForm();
```

### 5. Page 页面布局组件

使用 `Page` 组件作为页面根容器，提供统一的页面布局。

```vue
<script setup lang="ts">
import { Page } from '@vben/common-ui';
</script>

<template>
  <Page
    title="用户管理"
    description="管理系统用户信息"
    auto-content-height
  >
    <template #extra>
      <el-button type="primary">新增用户</el-button>
    </template>

    <!-- 页面内容 -->
    <div>页面内容区域</div>

    <template #footer>
      <div>页面底部</div>
    </template>
  </Page>
</template>
```

### 6. 其他 Vben 组件

```vue
<script setup lang="ts">
import {
  VbenAlert,           // 警告提示
  VbenEllipsisText,    // 文本省略
  VbenCountToAnimator, // 数字动画
} from '@vben/common-ui';
</script>

<template>
  <!-- 警告提示 -->
  <VbenAlert type="info" title="提示信息" />

  <!-- 文本省略 -->
  <VbenEllipsisText :text="longText" :max-width="200" />

  <!-- 数字动画 -->
  <VbenCountToAnimator :end-value="1000" :duration="2000" />
</template>
```

### Vben 组件适配器

每个应用需要配置组件适配器（`src/adapter/component.ts`），将 UI 框架组件注册到 Vben 组件系统：

```typescript
import { globalShareState } from '@vben/common-ui';
import { ElInput, ElSelect, ElButton } from 'element-plus';

// 注册组件
globalShareState.setComponents({
  Input: ElInput,
  Select: ElSelect,
  Button: ElButton,
  // ... 更多组件
});
```

## Element Plus 使用规范

### 1. 组件导入方式

```vue
<script setup lang="ts">
// ✅ 自动导入（项目已配置 unplugin-element-plus）
// 直接使用组件，无需手动导入
import { ElMessage, ElMessageBox } from 'element-plus';
import type { FormInstance, FormRules } from 'element-plus';
</script>

<template>
  <el-button type="primary">按钮</el-button>
  <el-form :model="form" :rules="rules">
    <el-form-item label="用户名" prop="username">
      <el-input v-model="form.username" />
    </el-form-item>
  </el-form>
</template>
```

### 2. 表单验证规范

```vue
<script setup lang="ts">
import { ref, reactive } from 'vue';
import type { FormInstance, FormRules } from 'element-plus';

interface LoginForm {
  username: string;
  password: string;
  remember: boolean;
}

const formRef = ref<FormInstance>();
const form = reactive<LoginForm>({
  username: '',
  password: '',
  remember: false,
});

const rules: FormRules<LoginForm> = {
  username: [
    { required: true, message: '请输入用户名', trigger: 'blur' },
    { min: 3, max: 20, message: '长度在 3 到 20 个字符', trigger: 'blur' },
  ],
  password: [
    { required: true, message: '请输入密码', trigger: 'blur' },
    { min: 6, message: '密码长度不能少于 6 位', trigger: 'blur' },
  ],
};

const handleSubmit = async () => {
  if (!formRef.value) return;
  await formRef.value.validate((valid) => {
    if (valid) {
      // 提交表单
    }
  });
};
</script>

<template>
  <el-form ref="formRef" :model="form" :rules="rules" label-width="80px">
    <el-form-item label="用户名" prop="username">
      <el-input v-model="form.username" placeholder="请输入用户名" />
    </el-form-item>
    <el-form-item label="密码" prop="password">
      <el-input v-model="form.password" type="password" show-password />
    </el-form-item>
    <el-form-item>
      <el-button type="primary" @click="handleSubmit">登录</el-button>
    </el-form-item>
  </el-form>
</template>
```

### 3. 表格使用规范

```vue
<script setup lang="ts">
import { ref, onMounted } from 'vue';
import type { TableColumnCtx } from 'element-plus';

interface User {
  id: string;
  username: string;
  email: string;
  status: number;
  createTime: string;
}

const loading = ref(false);
const tableData = ref<User[]>([]);
const total = ref(0);
const currentPage = ref(1);
const pageSize = ref(10);

const fetchData = async () => {
  loading.value = true;
  try {
    // API 调用
    const response = await getUserList({
      page: currentPage.value,
      pageSize: pageSize.value,
    });
    tableData.value = response.data;
    total.value = response.total;
  } finally {
    loading.value = false;
  }
};

const handleSizeChange = (val: number) => {
  pageSize.value = val;
  fetchData();
};

const handleCurrentChange = (val: number) => {
  currentPage.value = val;
  fetchData();
};

onMounted(() => {
  fetchData();
});
</script>

<template>
  <div class="p-4">
    <el-table
      v-loading="loading"
      :data="tableData"
      border
      stripe
      class="w-full"
    >
      <el-table-column prop="id" label="ID" width="80" />
      <el-table-column prop="username" label="用户名" />
      <el-table-column prop="email" label="邮箱" />
      <el-table-column label="状态" width="100">
        <template #default="{ row }">
          <el-tag :type="row.status === 1 ? 'success' : 'danger'">
            {{ row.status === 1 ? '启用' : '禁用' }}
          </el-tag>
        </template>
      </el-table-column>
      <el-table-column label="操作" width="200" fixed="right">
        <template #default="{ row }">
          <el-button type="primary" link size="small">编辑</el-button>
          <el-button type="danger" link size="small">删除</el-button>
        </template>
      </el-table-column>
    </el-table>

    <div class="mt-4 flex justify-end">
      <el-pagination
        v-model:current-page="currentPage"
        v-model:page-size="pageSize"
        :total="total"
        :page-sizes="[10, 20, 50, 100]"
        layout="total, sizes, prev, pager, next, jumper"
        @size-change="handleSizeChange"
        @current-change="handleCurrentChange"
      />
    </div>
  </div>
</template>
```

### 4. 消息提示规范

```typescript
import { ElMessage, ElMessageBox, ElNotification } from 'element-plus';

// ✅ 成功提示
ElMessage.success('操作成功');

// ✅ 错误提示
ElMessage.error('操作失败，请重试');

// ✅ 警告提示
ElMessage.warning('该操作不可逆，请谨慎操作');

// ✅ 确认对话框
const handleDelete = async (id: string) => {
  try {
    await ElMessageBox.confirm('确定要删除该项吗？', '提示', {
      confirmButtonText: '确定',
      cancelButtonText: '取消',
      type: 'warning',
    });

    await deleteUser(id);
    ElMessage.success('删除成功');
    fetchData();
  } catch (error) {
    if (error !== 'cancel') {
      ElMessage.error('删除失败');
    }
  }
};

// ✅ 通知
ElNotification({
  title: '系统通知',
  message: '您有新的消息',
  type: 'info',
  duration: 3000,
});
```

### 5. 对话框使用规范

```vue
<script setup lang="ts">
import { ref, reactive } from 'vue';
import type { FormInstance } from 'element-plus';

const dialogVisible = ref(false);
const formRef = ref<FormInstance>();
const form = reactive({
  name: '',
  email: '',
});

const handleOpen = () => {
  dialogVisible.value = true;
};

const handleClose = () => {
  formRef.value?.resetFields();
  dialogVisible.value = false;
};

const handleSubmit = async () => {
  if (!formRef.value) return;

  await formRef.value.validate(async (valid) => {
    if (valid) {
      // 提交逻辑
      await saveData(form);
      ElMessage.success('保存成功');
      handleClose();
    }
  });
};
</script>

<template>
  <el-button type="primary" @click="handleOpen">打开对话框</el-button>

  <el-dialog
    v-model="dialogVisible"
    title="编辑用户"
    width="600px"
    :close-on-click-modal="false"
    @close="handleClose"
  >
    <el-form ref="formRef" :model="form" label-width="80px">
      <el-form-item label="姓名" prop="name">
        <el-input v-model="form.name" />
      </el-form-item>
      <el-form-item label="邮箱" prop="email">
        <el-input v-model="form.email" />
      </el-form-item>
    </el-form>

    <template #footer>
      <el-button @click="handleClose">取消</el-button>
      <el-button type="primary" @click="handleSubmit">确定</el-button>
    </template>
  </el-dialog>
</template>
```

### 6. 下拉选择规范

```vue
<script setup lang="ts">
import { ref, onMounted } from 'vue';

interface Option {
  label: string;
  value: string | number;
}

const selectedValue = ref('');
const options = ref<Option[]>([]);
const loading = ref(false);

const fetchOptions = async () => {
  loading.value = true;
  try {
    const response = await getOptionList();
    options.value = response.data;
  } finally {
    loading.value = false;
  }
};

onMounted(() => {
  fetchOptions();
});
</script>

<template>
  <el-select
    v-model="selectedValue"
    placeholder="请选择"
    clearable
    filterable
    :loading="loading"
    class="w-full"
  >
    <el-option
      v-for="item in options"
      :key="item.value"
      :label="item.label"
      :value="item.value"
    />
  </el-select>
</template>
```

### 7. 日期选择规范

```vue
<script setup lang="ts">
import { ref } from 'vue';
import dayjs from 'dayjs';

const dateValue = ref('');
const dateRange = ref<[string, string]>(['', '']);

// 快捷选项
const shortcuts = [
  {
    text: '今天',
    value: () => new Date(),
  },
  {
    text: '最近一周',
    value: () => {
      const end = new Date();
      const start = new Date();
      start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
      return [start, end];
    },
  },
  {
    text: '最近一个月',
    value: () => {
      const end = new Date();
      const start = new Date();
      start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);
      return [start, end];
    },
  },
];
</script>

<template>
  <!-- 单个日期 -->
  <el-date-picker
    v-model="dateValue"
    type="date"
    placeholder="选择日期"
    format="YYYY-MM-DD"
    value-format="YYYY-MM-DD"
  />

  <!-- 日期范围 -->
  <el-date-picker
    v-model="dateRange"
    type="daterange"
    range-separator="至"
    start-placeholder="开始日期"
    end-placeholder="结束日期"
    format="YYYY-MM-DD"
    value-format="YYYY-MM-DD"
    :shortcuts="shortcuts"
  />
</template>
```

### 8. 树形控件规范

```vue
<script setup lang="ts">
import { ref, onMounted } from 'vue';
import type { ElTree } from 'element-plus';

interface TreeNode {
  id: string;
  label: string;
  children?: TreeNode[];
}

const treeRef = ref<InstanceType<typeof ElTree>>();
const treeData = ref<TreeNode[]>([]);
const checkedKeys = ref<string[]>([]);

const defaultProps = {
  children: 'children',
  label: 'label',
};

const handleNodeClick = (data: TreeNode) => {
  console.log('节点点击:', data);
};

const getCheckedNodes = () => {
  return treeRef.value?.getCheckedNodes();
};

onMounted(async () => {
  const response = await getTreeData();
  treeData.value = response.data;
});
</script>

<template>
  <el-tree
    ref="treeRef"
    :data="treeData"
    :props="defaultProps"
    show-checkbox
    node-key="id"
    :default-checked-keys="checkedKeys"
    @node-click="handleNodeClick"
  />
</template>
```

## 项目结构规范

### Monorepo 包结构

```
vue-vben-admin/
├── apps/                      # 应用目录
│   ├── web-ele/              # Element Plus 版本
│   ├── web-antd/             # Ant Design Vue 版本
│   ├── web-naive/            # Naive UI 版本
│   └── backend-mock/         # Mock API 服务
├── packages/                  # 共享包
│   ├── @core/                # 核心 UI 组件
│   │   ├── base/             # 基础功能
│   │   ├── ui-kit/           # UI 组件库
│   │   └── composables/      # 组合式函数
│   ├── effects/              # 业务效果包
│   │   ├── access/           # 权限控制
│   │   ├── layouts/          # 布局组件
│   │   ├── request/          # 请求封装
│   │   └── common-ui/        # 通用 UI
│   ├── stores/               # Pinia stores
│   ├── locales/              # 国际化
│   ├── utils/                # 工具函数
│   └── types/                # 类型定义
└── internal/                  # 内部工具
    ├── vite-config/          # Vite 配置
    ├── lint-configs/         # Lint 配置
    └── tsconfig/             # TS 配置
```

### 文件组织规范

```typescript
// 每个模块的 index.ts 应明确导出
export { useUserStore } from './user';
export { useAppStore } from './app';
export type { UserInfo, UserState } from './types';
```

## Bug 修复规范

1. **定位根因**: 深入分析问题本质，不做表面修复
2. **最小改动**: 仅修改有问题的代码，避免牵连无关逻辑
3. **添加注释**: 说明修复原因和问题根源
4. **类型安全**: 确保修复后的代码类型正确

```typescript
// ❌ 错误：直接屏蔽错误
// @ts-ignore
const result = dangerousFunction();

// ✅ 正确：修复类型问题
const result = dangerousFunction() as ExpectedType;
// 或者修改函数签名使其返回正确类型
```

## Git 提交规范

提交格式: `<type>: <subject>`

### Type 类型
- `feat`: 新功能
- `fix`: 修复 Bug
- `docs`: 文档更新
- `style`: 代码格式调整（不影响功能）
- `refactor`: 代码重构
- `perf`: 性能优化
- `test`: 测试相关
- `build`: 构建系统或依赖更新
- `ci`: CI/CD 配置修改
- `chore`: 其他杂项修改

### 提交示例
```bash
feat: 添加用户批量导入功能
fix: 修复登录状态丢失问题
refactor: 重构用户列表查询逻辑
perf: 优化表格渲染性能
docs: 更新 API 文档
```

### 提交原则
- 一次提交只做一件事
- Subject 不超过 50 字
- 使用中文描述
- 描述清晰、简洁

## 性能优化规范

### 1. 组件懒加载
```typescript
// 路由懒加载
const UserList = () => import('@/views/user/list.vue');

// 组件懒加载
const HeavyComponent = defineAsyncComponent(() =>
  import('@/components/HeavyComponent.vue')
);
```

### 2. 响应式优化
```typescript
import { shallowRef, shallowReactive } from 'vue';

// 对于大型对象，使用 shallowRef
const largeData = shallowRef<ComplexData[]>([]);

// 对于不需要深度响应的对象
const config = shallowReactive({
  settings: {},
});
```

### 3. 虚拟列表
```vue
<template>
  <!-- 大数据列表使用虚拟滚动 -->
  <VbenVirtualList
    :data="largeDataList"
    :item-height="50"
    :buffer="5"
  >
    <template #default="{ item }">
      <div>{{ item.name }}</div>
    </template>
  </VbenVirtualList>
</template>
```

## 国际化规范

```typescript
// 定义语言包
// locales/zh-CN/user.json
{
  "user": {
    "title": "用户管理",
    "list": "用户列表",
    "add": "添加用户"
  }
}

// 使用 i18n
import { $t } from '@/locales';

const title = $t('user.title');

// 在模板中
<template>
  <div>{{ $t('user.list') }}</div>
</template>
```

## 权限控制规范

```typescript
import { useAccessStore } from '@vben/access';

// 在组件中检查权限
const accessStore = useAccessStore();
const hasPermission = accessStore.hasAuthority('user:add');

// 在路由 meta 中配置
meta: {
  authority: ['user:view', 'user:edit'],
}

// 在模板中使用指令
<template>
  <button v-if="$hasAuthority('user:delete')">
    删除
  </button>
</template>
```

## 测试规范

```typescript
import { describe, it, expect } from 'vitest';
import { mount } from '@vue/test-utils';
import UserList from '@/views/user/UserList.vue';

describe('UserList', () => {
  it('renders user list correctly', () => {
    const wrapper = mount(UserList, {
      props: {
        users: [
          { id: '1', name: 'John' },
          { id: '2', name: 'Jane' },
        ],
      },
    });

    expect(wrapper.findAll('.user-item')).toHaveLength(2);
  });
});
```

## 常用命令

```bash
# 安装依赖
pnpm install

# 启动开发服务器
pnpm dev              # 选择启动的应用
pnpm dev:ele          # 启动 Element Plus 版本
pnpm dev:play         # 启动 Playground

# 构建
pnpm build            # 构建所有应用
pnpm build:ele        # 构建 Element Plus 版本

# 代码检查
pnpm lint             # ESLint 检查
pnpm format           # 代码格式化
pnpm check:type       # TypeScript 类型检查

# 测试
pnpm test:unit        # 单元测试
pnpm test:e2e         # E2E 测试
```

## 最佳实践

### 1. 组件设计
- 单一职责：每个组件只负责一个功能
- 可复用性：提取通用逻辑到 composables
- Props 验证：使用 TypeScript 接口定义 props
- 事件命名：使用明确的动词命名（如 `onUpdate`, `onSubmit`）

### 2. 状态管理
- 局部状态：使用 `ref`/`reactive`
- 全局状态：使用 Pinia store
- 持久化：使用 `@vben/preferences` 存储用户偏好

### 3. 错误处理
```typescript
import { message } from '@vben/common-ui';

try {
  await apiCall();
  message.success('操作成功');
} catch (error) {
  console.error('操作失败:', error);
  message.error(error.message || '操作失败，请重试');
}
```

### 4. 代码复用
```typescript
// composables/useTable.ts
export const useTable = <T>(fetchFn: (params: any) => Promise<T[]>) => {
  const loading = ref(false);
  const data = ref<T[]>([]);
  const pagination = reactive({
    page: 1,
    pageSize: 10,
    total: 0,
  });

  const fetchData = async () => {
    loading.value = true;
    try {
      const result = await fetchFn({
        page: pagination.page,
        pageSize: pagination.pageSize,
      });
      data.value = result;
    } finally {
      loading.value = false;
    }
  };

  return {
    loading,
    data,
    pagination,
    fetchData,
  };
};
```

## 禁止事项

- ❌ 禁止使用 `any` 类型（除非有充分理由）
- ❌ 禁止���用 Options API
- ❌ 禁止直接修改 props
- ❌ 禁止在 computed 中产生副作用
- ❌ 禁止使用 `var` 声明变量
- ❌ 禁止提交 console.log（生产环境）
- ❌ 禁止使用内联样式（除非必要）
- ❌ 禁止绕过 ESLint 规则（除非有充分理由并添加注释）

## 开发流程

1. **需求分析**: 明确需求和实现方案
2. **技术设计**: 考虑类型定义、组件结构、状态管理
3. **编码实现**: 遵循规范，编写完整可运行的代码
4. **自测验证**: 测试功能、检查类型、运行 lint
5. **代码审查**: 确保代码质量和规范性
6. **提交代码**: 使用规范的 commit message

## 问题排查

### 常见问题
1. **类型错误**: 检查导入路径和类型定义
2. **路径别名**: 确认 `tsconfig.json` 和 `vite.config.ts` 配置
3. **依赖问题**: 使用 `pnpm install --force` 重新安装
4. **构建失败**: 检查 TypeScript 错误和 ESLint 警告

### 调试技巧
```typescript
// 使用 Vue Devtools
// 使用 vite-plugin-inspect 检查构建
// 使用 Performance API 分析性能
```

## 官方文档参考

在开发过程中，如果遇到问题或需要了解详细功能，请优先参考 `docs/src/guide/` 目录下的官方文档：

### 基础指南 (essentials/)
- `concept.md` - 核心概念
- `development.md` - 开发指南
- `route.md` - 路由配置
- `settings.md` - 配置说明
- `styles.md` - 样式方案
- `icons.md` - 图标使用
- `build.md` - 构建部署
- `server.md` - 服务端交互
- `external-module.md` - 外部模块

### 深入理解 (in-depth/)
- `access.md` - **权限控制**（按钮权限、路由权限）
- `theme.md` - 主题配置
- `layout.md` - 布局系统
- `locale.md` - 国际化
- `login.md` - 登录认证
- `loading.md` - 加载状态
- `features.md` - 功能特性
- `ui-framework.md` - UI 框架适配
- `check-updates.md` - 版本更新

### 项目配置 (project/)
- `dir.md` - 目录结构
- `standard.md` - 开发规范
- `cli.md` - 命令行工具
- `vite.md` - Vite 配置
- `tailwindcss.md` - TailwindCSS 配置
- `changeset.md` - 变更日志
- `test.md` - 测试指南

### 其他 (other/)
- `faq.md` - 常见问题
- `project-update.md` - 项目升级
- `remove-code.md` - 代码清理

### 使用建议

1. **遇到权限控制问题** → 查看 `in-depth/access.md`
2. **需要配置路由** → 查看 `essentials/route.md`
3. **样式相关问题** → 查看 `essentials/styles.md` 和 `project/tailwindcss.md`
4. **构建部署问题** → 查看 `essentials/build.md` 和 `project/vite.md`
5. **国际化配置** → 查看 `in-depth/locale.md`
6. **主题定制** → 查看 `in-depth/theme.md`
7. **常见问题** → 查看 `other/faq.md`

## 总结

- 始终保持类型安全
- 遵循 Vue 3 最佳实践
- 保持代码简洁、可维护
- 注重性能和用户体验
- 及时更新技术栈
- **遇到问题优先查阅官方文档**
