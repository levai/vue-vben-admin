---
alwaysApply: true
---

# åç«¯å¼€å‘è§„èŒƒ

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¶æ„æ¦‚è§ˆ](#é¡¹ç›®æ¶æ„æ¦‚è§ˆ)
2. [Controller å±‚è®¾è®¡](#controller-å±‚è®¾è®¡)
3. [Service å±‚è®¾è®¡](#service-å±‚è®¾è®¡)
4. [æ•°æ®åº“æ“ä½œè®¾è®¡](#æ•°æ®åº“æ“ä½œè®¾è®¡)
5. [API è®¾è®¡è§„èŒƒ](#api-è®¾è®¡è§„èŒƒ)
6. [å¼‚å¸¸å¤„ç†è®¾è®¡](#å¼‚å¸¸å¤„ç†è®¾è®¡)
7. [å‚æ•°æ ¡éªŒè®¾è®¡](#å‚æ•°æ ¡éªŒè®¾è®¡)
8. [å·¥å…·ç±»ä½¿ç”¨è§„èŒƒ](#å·¥å…·ç±»ä½¿ç”¨è§„èŒƒ)
9. [å®é™…ä½¿ç”¨ç¤ºä¾‹](#å®é™…ä½¿ç”¨ç¤ºä¾‹)

---

## é¡¹ç›®æ¶æ„æ¦‚è§ˆ

Vue Vben Admin åç«¯æœåŠ¡é‡‡ç”¨**æ ‡å‡†åˆ†å±‚æ¶æ„**è®¾è®¡ï¼Œæ”¯æŒï¼š

- âœ… **åˆ†å±‚æ¸…æ™°**ï¼šController â†’ Service â†’ Mapper â†’ Database
- âœ… **ç»Ÿä¸€å“åº”**ï¼š`BaseResult<T>` å’Œ `PageResult<T>`
- âœ… **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨ `LambdaQueryWrapper` å’Œæ³›å‹
- âœ… **ä»£ç å¤ç”¨**ï¼šå·¥å…·ç±»å‡å°‘é‡å¤ä»£ç 
- âœ… **RESTful è®¾è®¡**ï¼šç¬¦åˆ REST è§„èŒƒ

### é¡¹ç›®ç»“æ„

```
com.vben.admin/
â”œâ”€â”€ BackendServiceApplication.java    # å¯åŠ¨ç±»
â”œâ”€â”€ config/                           # é…ç½®å±‚
â”‚   â”œâ”€â”€ SecurityConfiguration.java   # Spring Security é…ç½®
â”‚   â”œâ”€â”€ MybatisPlusConfig.java      # MyBatis Plus é…ç½®
â”‚   â”œâ”€â”€ Knife4jConfig.java           # Swagger é…ç½®
â”‚   â””â”€â”€ CorsConfig.java              # è·¨åŸŸé…ç½®
â”œâ”€â”€ controller/                       # æ§åˆ¶å±‚ï¼ˆRESTful APIï¼‰
â”œâ”€â”€ service/                          # æœåŠ¡å±‚
â”‚   â””â”€â”€ impl/                        # æœåŠ¡å®ç°
â”œâ”€â”€ mapper/                          # æ•°æ®è®¿é—®å±‚ï¼ˆMyBatisï¼‰
â”œâ”€â”€ model/                           # æ•°æ®æ¨¡å‹å±‚
â”‚   â”œâ”€â”€ entity/                     # å®ä½“ç±»ï¼ˆæ•°æ®åº“è¡¨æ˜ å°„ï¼‰
â”‚   â”œâ”€â”€ dto/                        # æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆè¯·æ±‚å‚æ•°ï¼‰
â”‚   â””â”€â”€ vo/                         # è§†å›¾å¯¹è±¡ï¼ˆå“åº”æ•°æ®ï¼‰
â””â”€â”€ core/                            # æ ¸å¿ƒåŠŸèƒ½
    â”œâ”€â”€ enums/                      # æšä¸¾ç±»
    â”œâ”€â”€ exception/                  # å¼‚å¸¸å¤„ç†
    â”œâ”€â”€ filter/                     # è¿‡æ»¤å™¨
    â”œâ”€â”€ model/                      # é€šç”¨æ¨¡å‹ï¼ˆBaseResultã€PageResultï¼‰
    â”œâ”€â”€ utils/                       # å·¥å…·ç±»
    â””â”€â”€ aspect/                      # AOP åˆ‡é¢
```

### è¯·æ±‚å¤„ç†æµç¨‹

```
HTTP è¯·æ±‚
  â†“
Controller å±‚ï¼ˆå‚æ•°æ ¡éªŒã€è·¯ç”±æ˜ å°„ï¼‰
  â†“
Service å±‚ï¼ˆä¸šåŠ¡é€»è¾‘å¤„ç†ï¼‰
  â†“
Mapper å±‚ï¼ˆæ•°æ®åº“æ“ä½œï¼‰
  â†“
Databaseï¼ˆMySQLï¼‰
  â†“
è¿”å›ç»“æœï¼ˆç»Ÿä¸€æ ¼å¼ BaseResult<T>ï¼‰
```

---

## Controller å±‚è®¾è®¡

### 1. Controller æ ‡å‡†ç»“æ„

Controller å±‚è´Ÿè´£æ¥æ”¶ HTTP è¯·æ±‚ï¼Œè¿›è¡Œå‚æ•°æ ¡éªŒï¼Œè°ƒç”¨ Service å±‚å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼š

```java:22:122:apps/backend-service/src/main/java/com/vben/admin/controller/SystemUserController.java
@Tag(name = "ç³»ç»Ÿç”¨æˆ·ç®¡ç†", description = "ç³»ç»Ÿç”¨æˆ·ç®¡ç†æ¥å£")
@RestController
@RequestMapping("/system/user")
@RequiredArgsConstructor
public class SystemUserController {

    private final UserService userService;

    @Operation(summary = "è·å–ç”¨æˆ·åˆ—è¡¨", description = "è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µå’Œæœç´¢ï¼‰")
    @GetMapping
    public BaseResult<PageResult<UserVO>> getList(
            @RequestParam(required = false, defaultValue = "1") Integer page,
            @RequestParam(required = false, defaultValue = "20") Integer pageSize,
            @RequestParam(required = false) String search,
            @RequestParam(required = false) String username,
            @RequestParam(required = false) String realName,
            @RequestParam(required = false) String deptId,
            @RequestParam(required = false) Integer status,
            @RequestParam(required = false) String startTime,
            @RequestParam(required = false) String endTime) {
        PageResult<UserVO> result = userService.getUserList(page, pageSize, search, username, realName, deptId, status, startTime, endTime);
        return new BaseResult<>(result);
    }

    @Operation(summary = "è·å–ç”¨æˆ·ä¿¡æ¯", description = "æ ¹æ®IDè·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯")
    @GetMapping("/{id}")
    public BaseResult<UserVO> getById(@PathVariable String id) {
        UserVO user = userService.getUserById(id);
        return new BaseResult<>(user);
    }

    @Operation(summary = "åˆ›å»ºç”¨æˆ·", description = "åˆ›å»ºæ–°ç”¨æˆ·")
    @PostMapping
    public BaseResult<String> create(@Validated(UserDTO.Create.class) @RequestBody UserDTO userDTO) {
        String id = userService.createUser(userDTO);
        return new BaseResult<>(id);
    }

    @Operation(summary = "æ›´æ–°ç”¨æˆ·", description = "æ›´æ–°ç”¨æˆ·ä¿¡æ¯")
    @PutMapping("/{id}")
    public BaseResult<Boolean> update(@PathVariable String id, @Validated(UserDTO.Update.class) @RequestBody UserDTO userDTO) {
        userService.updateUser(id, userDTO);
        return new BaseResult<>(true);
    }

    @Operation(summary = "åˆ é™¤ç”¨æˆ·", description = "åˆ é™¤ç”¨æˆ·ï¼ˆé€»è¾‘åˆ é™¤ï¼‰")
    @DeleteMapping("/{id}")
    public BaseResult<Boolean> delete(@PathVariable String id) {
        userService.deleteUser(id);
        return new BaseResult<>(true);
    }

    @Operation(summary = "è·å–ç”¨æˆ·é€‰é¡¹åˆ—è¡¨", description = "è·å–ç”¨æˆ·é€‰é¡¹åˆ—è¡¨ï¼ˆç”¨äºä¸‹æ‹‰é€‰é¡¹ï¼Œæ”¯æŒ limit é™åˆ¶ï¼Œæ”¯æŒæ¡ä»¶æŸ¥è¯¢ï¼Œè¿”å›å®Œæ•´ç”¨æˆ·ä¿¡æ¯ï¼Œå‰ç«¯è‡ªè¡Œå¤„ç† label å’Œ valueï¼‰")
    @GetMapping("/options")
    public BaseResult<PageResult<UserVO>> getOptions(UserOptionQueryDTO queryDTO) {
        PageResult<UserVO> result = userService.getUserOptions(queryDTO);
        return new BaseResult<>(result);
    }
}
```

**è®¾è®¡è¦ç‚¹**ï¼š
1. **ä½¿ç”¨ `@RequiredArgsConstructor`**ï¼šæ›¿ä»£ `@Autowired`ï¼Œé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–
2. **ç»Ÿä¸€è¿”å›ç±»å‹**ï¼šæ‰€æœ‰æ¥å£è¿”å› `BaseResult<T>`
3. **RESTful è®¾è®¡**ï¼šä½¿ç”¨æ ‡å‡† HTTP æ–¹æ³•ï¼ˆGETã€POSTã€PUTã€DELETEï¼‰
4. **å‚æ•°æ ¡éªŒ**ï¼šä½¿ç”¨ `@Valid` æˆ– `@Validated` è¿›è¡Œåˆ†ç»„æ ¡éªŒ
5. **Swagger æ³¨è§£**ï¼šä½¿ç”¨ `@Operation` å’Œ `@Tag` æä¾› API æ–‡æ¡£

### 2. RESTful è·¯ç”±è®¾è®¡

**æ ‡å‡† CRUD æ¥å£**ï¼ˆæ‰€æœ‰æ¨¡å—ç»Ÿä¸€ä½¿ç”¨èµ„æºæ ¹è·¯å¾„ï¼‰ï¼š

```
GET    /system/user              # åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
GET    /system/user/{id}         # è¯¦æƒ…
POST   /system/user              # åˆ›å»º
PUT    /system/user/{id}         # æ›´æ–°
DELETE /system/user/{id}         # åˆ é™¤
```

**æ‰€æœ‰ç³»ç»Ÿæ¨¡å—ç»Ÿä¸€è§„èŒƒ**ï¼š

```
GET    /system/user              # ç”¨æˆ·åˆ—è¡¨
GET    /system/role              # è§’è‰²åˆ—è¡¨
GET    /system/menu              # èœå•åˆ—è¡¨
GET    /system/dept              # éƒ¨é—¨åˆ—è¡¨
GET    /system/operation-log     # æ“ä½œæ—¥å¿—åˆ—è¡¨
```

**å­èµ„æºæ¥å£**ï¼š

```
GET    /system/user/options      # é€‰é¡¹åˆ—è¡¨ï¼ˆlimit é™åˆ¶ï¼‰
PUT    /system/user/{id}/status  # æ›´æ–°çŠ¶æ€ï¼ˆåŠ¨ä½œï¼‰
PUT    /system/user/{id}/password # é‡ç½®å¯†ç ï¼ˆåŠ¨ä½œï¼‰
```

**è§„èŒƒè¦ç‚¹**ï¼š
- âœ… **ç»Ÿä¸€ä½¿ç”¨èµ„æºæ ¹è·¯å¾„**ï¼šåˆ—è¡¨æ¥å£ä½¿ç”¨ `GET /resource`ï¼Œä¸ä½¿ç”¨ `/list` åç¼€
- âœ… **ç¬¦åˆ RESTful è§„èŒƒ**ï¼šèµ„æºå³ URLï¼Œé€šè¿‡ HTTP æ–¹æ³•åŒºåˆ†æ“ä½œ
- âœ… **ä¿æŒä¸€è‡´æ€§**ï¼šæ‰€æœ‰æ¨¡å—éµå¾ªç›¸åŒçš„è·¯ç”±è®¾è®¡è§„èŒƒ

### 3. ç»Ÿä¸€è¿”å›æ ¼å¼

**æ‰€æœ‰æ¥å£ç»Ÿä¸€ä½¿ç”¨ `BaseResult<T>`**ï¼š

```java:14:77:apps/backend-service/src/main/java/com/vben/admin/core/model/BaseResult.java
@Data
public class BaseResult<E> implements Serializable {

    private static final long serialVersionUID = 1L;

    /**
     * çŠ¶æ€ç ï¼š0æˆåŠŸï¼Œå…¶ä»–ä¸ºå¤±è´¥
     */
    public int code;

    /**
     * æˆåŠŸä¸ºokï¼Œå…¶ä»–ä¸ºå¤±è´¥åŸå› 
     */
    public String message;

    /**
     * æ•°æ®ç»“æœé›†
     */
    public E data;

    public BaseResult() {
        this.code = ErrMsg.DEFAULT_SUCCESS_CODE;
        this.message = ErrMsg.DEFAULT_SUCCESS_MESSAGE;
    }

    public BaseResult(E data) {
        this();
        this.data = data;
    }
}
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "code": 0,
  "message": "ok",
  "data": T
}
```

**åˆ†é¡µæ¥å£è¿”å› `PageResult<T>`**ï¼š

```java:15:41:apps/backend-service/src/main/java/com/vben/admin/core/model/PageResult.java
@Data
@NoArgsConstructor
@AllArgsConstructor
public class PageResult<T> {

    /**
     * æ•°æ®åˆ—è¡¨
     */
    private List<T> items;

    /**
     * æ€»è®°å½•æ•°
     */
    private Long total;

    /**
     * åˆ›å»ºåˆ†é¡µç»“æœ
     */
    public static <T> PageResult<T> of(List<T> items, Long total) {
        return new PageResult<>(items, total);
    }
}
```

**åˆ†é¡µå“åº”æ ¼å¼**ï¼š
```json
{
  "code": 0,
  "message": "ok",
  "data": {
    "items": List<T>,
    "total": 100
  }
}
```

---

## Service å±‚è®¾è®¡

### 1. Service æ¥å£è®¾è®¡

Service æ¥å£å®šä¹‰ä¸šåŠ¡æ–¹æ³•ï¼Œä½¿ç”¨æ¸…æ™°çš„ JavaDoc æ³¨é‡Šï¼š

```java:13:85:apps/backend-service/src/main/java/com/vben/admin/service/UserService.java
public interface UserService {

    /**
     * è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µï¼‰
     *
     * @param page      é¡µç ï¼ˆä»1å¼€å§‹ï¼‰
     * @param pageSize  æ¯é¡µå¤§å°
     * @param search    æœç´¢å…³é”®è¯ï¼ˆæ¨¡ç³ŠæŸ¥è¯¢ç”¨æˆ·åå’ŒçœŸå®å§“åï¼Œä¼˜å…ˆçº§é«˜äº username/realNameï¼‰
     * @param username  ç”¨æˆ·åï¼ˆæ¨¡ç³ŠæŸ¥è¯¢ï¼Œä¸ search äº’æ–¥ï¼‰
     * @param realName  çœŸå®å§“åï¼ˆæ¨¡ç³ŠæŸ¥è¯¢ï¼Œä¸ search äº’æ–¥ï¼‰
     * @param deptId    éƒ¨é—¨ID
     * @param status    çŠ¶æ€ï¼ˆ0-ç¦ç”¨ï¼Œ1-å¯ç”¨ï¼‰
     * @param startTime å¼€å§‹æ—¶é—´ï¼ˆæ ¼å¼ï¼šyyyy-MM-ddï¼‰
     * @param endTime   ç»“æŸæ—¶é—´ï¼ˆæ ¼å¼ï¼šyyyy-MM-ddï¼‰
     * @return åˆ†é¡µç»“æœ
     */
    PageResult<UserVO> getUserList(Integer page, Integer pageSize, String search, String username, String realName, String deptId, Integer status, String startTime, String endTime);

    /**
     * è·å–ç”¨æˆ·é€‰é¡¹åˆ—è¡¨ï¼ˆç”¨äºä¸‹æ‹‰é€‰é¡¹ï¼Œæ”¯æŒ limit é™åˆ¶ï¼‰
     *
     * @param queryDTO æŸ¥è¯¢æ¡ä»¶
     * @return ç”¨æˆ·é€‰é¡¹åˆ—è¡¨ï¼ˆåŒ…å«æ‰€æœ‰ç”¨æˆ·å­—æ®µï¼Œå‰ç«¯è‡ªè¡Œå¤„ç† label å’Œ valueï¼‰
     */
    PageResult<UserVO> getUserOptions(UserOptionQueryDTO queryDTO);
}
```

### 2. Service å®ç°ç±»è®¾è®¡

Service å®ç°ç±»ä½¿ç”¨ `@Service` å’Œ `@RequiredArgsConstructor`ï¼Œå®ç°ä¸šåŠ¡é€»è¾‘ï¼š

```java:20:100:apps/backend-service/src/main/java/com/vben/admin/service/impl/UserServiceImpl.java
@Service
@RequiredArgsConstructor
public class UserServiceImpl implements UserService {

    private final UserMapper userMapper;

    @Override
    public PageResult<UserVO> getUserList(Integer page, Integer pageSize, String search, String username, String realName, String deptId, Integer status, String startTime, String endTime) {
        // æ„å»ºæŸ¥è¯¢æ¡ä»¶
        LambdaQueryWrapper<SysUser> queryWrapper = new LambdaQueryWrapper<>();

        // æœç´¢å…³é”®è¯ï¼ˆä¼˜å…ˆçº§é«˜äº username/realNameï¼‰
        if (StringUtils.hasText(search)) {
            queryWrapper.and(wrapper -> wrapper
                    .like(SysUser::getUsername, search)
                    .or()
                    .like(SysUser::getRealName, search)
            );
        } else {
            // å¦‚æœæ²¡æœ‰ searchï¼Œä½¿ç”¨ username å’Œ realName
            if (StringUtils.hasText(username)) {
                queryWrapper.like(SysUser::getUsername, username);
            }
            if (StringUtils.hasText(realName)) {
                queryWrapper.like(SysUser::getRealName, realName);
            }
        }

        // å…¶ä»–æŸ¥è¯¢æ¡ä»¶...
        // æ—¶é—´èŒƒå›´æŸ¥è¯¢
        QueryHelper.applyTimeRange(queryWrapper, startTime, endTime, SysUser::getCreateTime);

        queryWrapper.orderByDesc(SysUser::getCreateTime);

        // åˆ†é¡µæŸ¥è¯¢
        Page<SysUser> pageParam = new Page<>(page, pageSize);
        IPage<SysUser> pageResult = userMapper.selectPage(pageParam, queryWrapper);

        // è½¬æ¢ä¸ºVO
        List<UserVO> voList = pageResult.getRecords().stream()
                .map(this::convertToVO)
                .collect(Collectors.toList());

        return PageResult.of(voList, pageResult.getTotal());
    }
}
```

**è®¾è®¡è¦ç‚¹**ï¼š
1. **ä½¿ç”¨ `@Service`**ï¼šæ ‡è¯†æœåŠ¡å±‚ç»„ä»¶
2. **ä½¿ç”¨ `@RequiredArgsConstructor`**ï¼šæ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–
3. **äº‹åŠ¡ç®¡ç†**ï¼šå†™æ“ä½œä½¿ç”¨ `@Transactional(rollbackFor = Exception.class)`
4. **ä½¿ç”¨å·¥å…·ç±»**ï¼šæ—¶é—´èŒƒå›´æŸ¥è¯¢ä½¿ç”¨ `QueryHelper.applyTimeRange()`
5. **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨ `LambdaQueryWrapper` è€Œä¸æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥
6. **VO è½¬æ¢**ï¼šä½¿ç”¨ `BeanUtils.copyProperties()` æˆ–æ‰‹åŠ¨æ˜ å°„

---

## æ•°æ®åº“æ“ä½œè®¾è®¡

### 1. MyBatis Plus æŸ¥è¯¢æ¡ä»¶æ„å»º

**ä½¿ç”¨ `LambdaQueryWrapper`ï¼ˆç±»å‹å®‰å…¨ï¼‰**ï¼š

```java
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ LambdaQueryWrapper
LambdaQueryWrapper<SysUser> queryWrapper = new LambdaQueryWrapper<>();
queryWrapper.like(SysUser::getUsername, keyword);
queryWrapper.eq(SysUser::getStatus, 1);

// âŒ é”™è¯¯ï¼šé¿å…å­—ç¬¦ä¸²æ‹¼æ¥
QueryWrapper<SysUser> queryWrapper = new QueryWrapper<>();
queryWrapper.like("username", keyword);  // ä¸æ¨è
```

### 2. åˆ†é¡µæŸ¥è¯¢

```java
// åˆ†é¡µæŸ¥è¯¢
Page<SysUser> pageParam = new Page<>(page, pageSize);
IPage<SysUser> pageResult = userMapper.selectPage(pageParam, queryWrapper);

// è½¬æ¢ä¸ºVO
List<UserVO> voList = pageResult.getRecords().stream()
        .map(this::convertToVO)
        .collect(Collectors.toList());

return PageResult.of(voList, pageResult.getTotal());
```

### 3. é€»è¾‘åˆ é™¤

**Entity ä¸­ä½¿ç”¨ `@TableLogic`**ï¼š

```java
@TableLogic
private Integer deleted;
```

**æŸ¥è¯¢æ—¶è‡ªåŠ¨è¿‡æ»¤ deleted=1 çš„è®°å½•ï¼Œåˆ é™¤æ—¶è‡ªåŠ¨æ›´æ–° deleted=1ï¼Œä¸ç‰©ç†åˆ é™¤**

### 4. å·¥å…·ç±»ä½¿ç”¨

**æ—¶é—´èŒƒå›´æŸ¥è¯¢**ï¼š

```java:37:64:apps/backend-service/src/main/java/com/vben/admin/core/utils/QueryHelper.java
public static <T> void applyTimeRange(
        LambdaQueryWrapper<T> queryWrapper,
        String startTime,
        String endTime,
        SFunction<T, ?> timeField
) {
    // å¼€å§‹æ—¶é—´æŸ¥è¯¢
    if (StringUtils.hasText(startTime)) {
        try {
            LocalDate startDate = LocalDate.parse(startTime, DateTimeFormatter.ISO_LOCAL_DATE);
            LocalDateTime startDateTime = startDate.atStartOfDay();
            queryWrapper.ge(timeField, startDateTime);
        } catch (DateTimeParseException e) {
            log.warn("æ— æ•ˆçš„å¼€å§‹æ—¶é—´æ ¼å¼: {}, é”™è¯¯: {}", startTime, e.getMessage());
        }
    }

    // ç»“æŸæ—¶é—´æŸ¥è¯¢
    if (StringUtils.hasText(endTime)) {
        try {
            LocalDate endDate = LocalDate.parse(endTime, DateTimeFormatter.ISO_LOCAL_DATE);
            LocalDateTime endDateTime = endDate.atTime(23, 59, 59);
            queryWrapper.le(timeField, endDateTime);
        } catch (DateTimeParseException e) {
            log.warn("æ— æ•ˆçš„ç»“æŸæ—¶é—´æ ¼å¼: {}, é”™è¯¯: {}", endTime, e.getMessage());
        }
    }
}
```

**Limit é™åˆ¶**ï¼š

```java:74:84:apps/backend-service/src/main/java/com/vben/admin/core/utils/QueryHelper.java
public static <T> List<T> applyLimit(List<T> list, Integer limit) {
    if (list == null || list.isEmpty()) {
        return list;
    }

    int maxLimit = (limit != null && limit > 0) ? limit : DEFAULT_LIMIT;
    if (list.size() > maxLimit) {
        return list.subList(0, maxLimit);
    }
    return list;
}
```

---

## API è®¾è®¡è§„èŒƒ

### 1. List æ¥å£å‚æ•°è®¾è®¡

**æ ‡å‡†å‚æ•°**ï¼š

```java
@GetMapping
public BaseResult<PageResult<UserVO>> getList(
    @RequestParam(required = false, defaultValue = "1") Integer page,        // é¡µç ï¼Œé»˜è®¤1
    @RequestParam(required = false, defaultValue = "20") Integer pageSize, // æ¯é¡µå¤§å°ï¼Œé»˜è®¤20
    @RequestParam(required = false) String search,                          // æœç´¢å…³é”®è¯
    @RequestParam(required = false) String username,                        // å…·ä½“å­—æ®µæŸ¥è¯¢
    // ... å…¶ä»–æŸ¥è¯¢æ¡ä»¶
)
```

**è§„èŒƒ**ï¼š
- `page` å’Œ `pageSize` æœ‰é»˜è®¤å€¼
- `search` å‚æ•°ä¼˜å…ˆçº§é«˜äºå…·ä½“å­—æ®µ
- æ—¶é—´èŒƒå›´ä½¿ç”¨ `startTime` å’Œ `endTime`ï¼ˆæ ¼å¼ï¼š`yyyy-MM-dd`ï¼‰

### 2. Options æ¥å£å‚æ•°è®¾è®¡

**ä½¿ç”¨ DTO å°è£…å‚æ•°**ï¼š

```java:10:52:apps/backend-service/src/main/java/com/vben/admin/model/dto/UserOptionQueryDTO.java
@Data
public class UserOptionQueryDTO {

    /**
     * æœç´¢å…³é”®è¯ï¼ˆæ¨¡ç³ŠæŸ¥è¯¢ç”¨æˆ·åå’ŒçœŸå®å§“åï¼Œä¼˜å…ˆçº§é«˜äº username/realNameï¼‰
     */
    private String search;

    /**
     * ç”¨æˆ·åï¼ˆæ¨¡ç³ŠæŸ¥è¯¢ï¼Œä¸ search äº’æ–¥ï¼‰
     */
    private String username;

    /**
     * çœŸå®å§“åï¼ˆæ¨¡ç³ŠæŸ¥è¯¢ï¼Œä¸ search äº’æ–¥ï¼‰
     */
    private String realName;

    /**
     * éƒ¨é—¨ID
     */
    private String deptId;

    /**
     * çŠ¶æ€ï¼ˆ0-ç¦ç”¨ï¼Œ1-å¯ç”¨ï¼‰
     */
    private Integer status;

    /**
     * å¼€å§‹æ—¶é—´ï¼ˆæ ¼å¼ï¼šyyyy-MM-ddï¼‰
     */
    private String startTime;

    /**
     * ç»“æŸæ—¶é—´ï¼ˆæ ¼å¼ï¼šyyyy-MM-ddï¼‰
     */
    private String endTime;

    /**
     * æœ€å¤§è¿”å›æ•°é‡ï¼ˆé»˜è®¤ 1000ï¼Œé˜²æ­¢æ•°æ®é‡è¿‡å¤§ï¼‰
     */
    private Integer limit = 1000;
}
```

**è§„èŒƒ**ï¼š
- DTO ä¸­ `limit` æœ‰é»˜è®¤å€¼ï¼ˆ1000ï¼‰
- æ”¯æŒæ‰€æœ‰æŸ¥è¯¢æ¡ä»¶ï¼ˆä¸ List æ¥å£ä¸€è‡´ï¼‰
- ä¸ä½¿ç”¨åˆ†é¡µï¼Œç›´æ¥è¿”å›æ‰€æœ‰æ•°æ®ï¼ˆå— limit é™åˆ¶ï¼‰

### 3. æŸ¥è¯¢å‚æ•°è¯­ä¹‰åŒ–

**ç»Ÿä¸€ä½¿ç”¨ `search` ä»£æ›¿ `keyword`**ï¼š

```java
// âœ… æ­£ç¡®
@RequestParam(required = false) String search

// âŒ é”™è¯¯
@RequestParam(required = false) String keyword
```

---

## å¼‚å¸¸å¤„ç†è®¾è®¡

### 1. ç»Ÿä¸€å¼‚å¸¸å¤„ç†

**å…¨å±€å¼‚å¸¸å¤„ç†å™¨**ï¼š

```java:26:76:apps/backend-service/src/main/java/com/vben/admin/core/exception/GlobalExceptionHandler.java
@RestControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(BusinessException.class)
    public BaseResult<?> handleBusinessException(BusinessException e) {
        return BaseResult.error(e.getMessage());
    }

    @ExceptionHandler(MethodArgumentNotValidException.class)
    public BaseResult<?> handleValidationException(MethodArgumentNotValidException e) {
        // å‚æ•°æ ¡éªŒå¼‚å¸¸å¤„ç†
    }
}
```

### 2. ä¸šåŠ¡å¼‚å¸¸

**ä½¿ç”¨ `BusinessException`**ï¼š

```java
if (user == null) {
    throw new BusinessException("ç”¨æˆ·ä¸å­˜åœ¨");
}

if (count > 0) {
    throw new BusinessException("ç”¨æˆ·åå·²å­˜åœ¨");
}
```

**è§„èŒƒ**ï¼š
- å¼‚å¸¸æ¶ˆæ¯è¦æ¸…æ™°æ˜ç¡®
- ä½¿ç”¨ä¸­æ–‡é”™è¯¯æ¶ˆæ¯ï¼ˆä¾¿äºå‰ç«¯æ˜¾ç¤ºï¼‰
- ä¸è¦æš´éœ²ç³»ç»Ÿå†…éƒ¨ä¿¡æ¯

---

## å‚æ•°æ ¡éªŒè®¾è®¡

### 1. Bean Validation

**DTO ä¸­ä½¿ç”¨æ ¡éªŒæ³¨è§£**ï¼š

```java
@Data
public class UserDTO {

    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Size(min = 3, max = 20, message = "ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-20ä¹‹é—´")
    private String username;

    @NotBlank(message = "å¯†ç ä¸èƒ½ä¸ºç©º")
    @Size(min = 6, max = 50, message = "å¯†ç é•¿åº¦å¿…é¡»åœ¨6-50ä¹‹é—´")
    private String password;
}
```

### 2. åˆ†ç»„æ ¡éªŒ

**åˆ›å»ºå’Œæ›´æ–°ä½¿ç”¨ä¸åŒæ ¡éªŒè§„åˆ™**ï¼š

```java
public class UserDTO {

    public interface Create {}
    public interface Update {}

    @NotBlank(groups = Create.class, message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    private String username;

    @NotBlank(groups = Create.class, message = "å¯†ç ä¸èƒ½ä¸ºç©º")
    private String password;
}

// Controller ä¸­ä½¿ç”¨
@PostMapping
public BaseResult<String> create(@Validated(UserDTO.Create.class) @RequestBody UserDTO userDTO) {
    // ...
}

@PutMapping("/{id}")
public BaseResult<Boolean> update(@PathVariable String id, @Validated(UserDTO.Update.class) @RequestBody UserDTO userDTO) {
    // ...
}
```

---

## å·¥å…·ç±»ä½¿ç”¨è§„èŒƒ

### 1. QueryHelper å·¥å…·ç±»

**ä½ç½®**ï¼š`apps/backend-service/src/main/java/com/vben/admin/core/utils/QueryHelper.java`

**å¸¸ç”¨æ–¹æ³•**ï¼š

```java
// æ—¶é—´èŒƒå›´æŸ¥è¯¢
QueryHelper.applyTimeRange(queryWrapper, startTime, endTime, SysUser::getCreateTime);

// Limit é™åˆ¶
List<UserVO> users = QueryHelper.applyLimit(users, limit);

// è·å–æœ‰æ•ˆ limit
int maxLimit = QueryHelper.getValidLimit(limit);
```

**å¸¸é‡**ï¼š

```java:26:26:apps/backend-service/src/main/java/com/vben/admin/core/utils/QueryHelper.java
public static final int DEFAULT_LIMIT = 1000;
```

### 2. å…¶ä»–å·¥å…·ç±»

- `SecurityUtils` - å®‰å…¨å·¥å…·ï¼ˆè·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼‰
- `OperationInfoParser` - æ“ä½œä¿¡æ¯è§£æ
- `BrowserInfoParser` - æµè§ˆå™¨ä¿¡æ¯è§£æ
- `SensitiveDataFilter` - æ•æ„Ÿä¿¡æ¯è¿‡æ»¤

---

## å®é™…ä½¿ç”¨ç¤ºä¾‹

### 1. å®Œæ•´çš„ CRUD æ¥å£å®ç°

```java
@RestController
@RequestMapping("/system/user")
@RequiredArgsConstructor
public class SystemUserController {

    private final UserService userService;

    // åˆ—è¡¨æŸ¥è¯¢
    @GetMapping
    public BaseResult<PageResult<UserVO>> getList(...) {
        PageResult<UserVO> result = userService.getUserList(...);
        return new BaseResult<>(result);
    }

    // è¯¦æƒ…æŸ¥è¯¢
    @GetMapping("/{id}")
    public BaseResult<UserVO> getById(@PathVariable String id) {
        UserVO user = userService.getUserById(id);
        return new BaseResult<>(user);
    }

    // åˆ›å»º
    @PostMapping
    public BaseResult<String> create(@Validated(UserDTO.Create.class) @RequestBody UserDTO userDTO) {
        String id = userService.createUser(userDTO);
        return new BaseResult<>(id);
    }

    // æ›´æ–°
    @PutMapping("/{id}")
    public BaseResult<Boolean> update(@PathVariable String id, @Validated(UserDTO.Update.class) @RequestBody UserDTO userDTO) {
        userService.updateUser(id, userDTO);
        return new BaseResult<>(true);
    }

    // åˆ é™¤
    @DeleteMapping("/{id}")
    public BaseResult<Boolean> delete(@PathVariable String id) {
        userService.deleteUser(id);
        return new BaseResult<>(true);
    }
}
```

### 2. Service å±‚æŸ¥è¯¢å®ç°

```java
@Override
public PageResult<UserVO> getUserList(Integer page, Integer pageSize, String search, ...) {
    // æ„å»ºæŸ¥è¯¢æ¡ä»¶
    LambdaQueryWrapper<SysUser> queryWrapper = new LambdaQueryWrapper<>();

    // æœç´¢å…³é”®è¯ï¼ˆä¼˜å…ˆçº§é«˜äº username/realNameï¼‰
    if (StringUtils.hasText(search)) {
        queryWrapper.and(wrapper -> wrapper
                .like(SysUser::getUsername, search)
                .or()
                .like(SysUser::getRealName, search)
        );
    }

    // æ—¶é—´èŒƒå›´æŸ¥è¯¢
    QueryHelper.applyTimeRange(queryWrapper, startTime, endTime, SysUser::getCreateTime);

    // åˆ†é¡µæŸ¥è¯¢
    Page<SysUser> pageParam = new Page<>(page, pageSize);
    IPage<SysUser> pageResult = userMapper.selectPage(pageParam, queryWrapper);

    // è½¬æ¢ä¸ºVO
    List<UserVO> voList = pageResult.getRecords().stream()
            .map(this::convertToVO)
            .collect(Collectors.toList());

    return PageResult.of(voList, pageResult.getTotal());
}
```

### 3. Options æ¥å£å®ç°

```java
@Override
public PageResult<UserVO> getUserOptions(UserOptionQueryDTO queryDTO) {
    // æ„å»ºæŸ¥è¯¢æ¡ä»¶ï¼ˆä¸ List æ¥å£ä¸€è‡´ï¼‰
    LambdaQueryWrapper<SysUser> queryWrapper = new LambdaQueryWrapper<>();
    // ... æŸ¥è¯¢æ¡ä»¶æ„å»º

    // æŸ¥è¯¢æ‰€æœ‰æ•°æ®ï¼ˆä¸åˆ†é¡µï¼‰
    List<SysUser> users = userMapper.selectList(queryWrapper);

    // åº”ç”¨ limit é™åˆ¶
    users = QueryHelper.applyLimit(users, queryDTO.getLimit());

    // è½¬æ¢ä¸ºVO
    List<UserVO> voList = users.stream()
            .map(this::convertToVO)
            .collect(Collectors.toList());

    return PageResult.of(voList, (long) voList.size());
}
```

---

## æ€»ç»“

Vue Vben Admin åç«¯å¼€å‘è§„èŒƒç‰¹ç‚¹ï¼š

1. **åˆ†å±‚æ¸…æ™°**ï¼šController â†’ Service â†’ Mapper â†’ Database
2. **ç»Ÿä¸€å“åº”**ï¼š`BaseResult<T>` å’Œ `PageResult<T>`
3. **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨ `LambdaQueryWrapper` å’Œæ³›å‹
4. **ä»£ç å¤ç”¨**ï¼šä½¿ç”¨å·¥å…·ç±»å‡å°‘é‡å¤ä»£ç 
5. **å‚æ•°å°è£…**ï¼šOptions æ¥å£ä½¿ç”¨ DTO
6. **è¯­ä¹‰åŒ–å‘½å**ï¼šä½¿ç”¨ `search` ä»£æ›¿ `keyword`
7. **RESTful è®¾è®¡**ï¼šç¬¦åˆ REST è§„èŒƒ
8. **å¼‚å¸¸å¤„ç†**ï¼šç»Ÿä¸€å¼‚å¸¸å¤„ç†å’Œä¸šåŠ¡å¼‚å¸¸

åç«¯å¼€å‘æ ¸å¿ƒæµç¨‹ï¼š
1. Controller æ¥æ”¶è¯·æ±‚ â†’ å‚æ•°æ ¡éªŒ
2. Service å¤„ç†ä¸šåŠ¡é€»è¾‘ â†’ è°ƒç”¨ Mapper
3. Mapper æ‰§è¡Œæ•°æ®åº“æ“ä½œ â†’ è¿”å› Entity
4. Service è½¬æ¢ä¸º VO â†’ è¿”å›ç»“æœ
5. Controller å°è£…ä¸º BaseResult â†’ è¿”å›å‰ç«¯
